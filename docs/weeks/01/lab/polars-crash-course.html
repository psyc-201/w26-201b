<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.8.27">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Eshin Jolly">
<meta name="dcterms.date" content="2026-01-07">

<title>A Crash Course on Python DataFrames – PSYC 201B</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
html { -webkit-text-size-adjust: 100%; }
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdn.jsdelivr.net/npm/jquery@3.5.1/dist/jquery.min.js" integrity="sha384-ZvpUoO/+PpLXR1lu4jmpXWu80pZlYUAfxl5NsBMWOEPSjUn/6Z/hRTt8+pR6L4N2" crossorigin="anonymous"></script><script src="../../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../../">
<script src="../../../site_libs/quarto-html/quarto.js" type="module"></script>
<script src="../../../site_libs/quarto-html/tabsets/tabsets.js" type="module"></script>
<script src="../../../site_libs/quarto-html/axe/axe-check.js" type="module"></script>
<script src="../../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../../site_libs/quarto-html/quarto-syntax-highlighting-ed96de9b727972fe78a7b5d16c58bf87.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../../site_libs/bootstrap/bootstrap-a936dd0cd06bcb31d39d5fba7942d483.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdn.jsdelivr.net/npm/requirejs@2.3.6/require.min.js" integrity="sha384-c9c+LnTbwQ3aujuU7ULEPVvgLs+Fn6fJUvIGTsuu1ZcCf11fiEubah0ttpca4ntM sha384-6V1/AdqZRWk1KAlWbKBlGhN7VG4iE/yAZcO6NZPMF8od0vukrvr0tg4qY6NSrItx" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>
<script type="module" src="https://cdn.jsdelivr.net/npm/@marimo-team/islands@0.14.16/dist/main.js"></script>
<link href="https://cdn.jsdelivr.net/npm/@marimo-team/islands@0.14.16/dist/style.css" rel="stylesheet" crossorigin="anonymous">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="">
<link href="https://fonts.googleapis.com/css2?family=Fira+Mono:wght@400;500;700&amp;family=Lora&amp;family=PT+Sans:wght@400;700&amp;display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.10/dist/katex.min.css" integrity="sha384-wcIxkf4k558AjM3Yz3BBFQUbk/zgIYC2R0QpeeYb+TwlBVMrlgLqwRjRtGZiK7ww" crossorigin="anonymous">
</head><body class="nav-sidebar docked nav-fixed quarto-light"><marimo-filename hidden=""></marimo-filename>


<link rel="stylesheet" href="../../../assets/custom.css">




<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="../../../index.html" class="navbar-brand navbar-brand-logo">
    <img src="../../../logo25.png" alt="" class="navbar-logo light-content">
    <img src="../../../logo25.png" alt="" class="navbar-logo dark-content">
    </a>
    <a class="navbar-brand" href="../../../index.html">
    <span class="navbar-title">PSYC 201B</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" role="menu" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../../schedule.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-guides--resources" role="link" data-bs-toggle="dropdown" aria-expanded="false">
 <span class="menu-text">Guides &amp; Resources</span>
    </a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-guides--resources">    
        <li>
    <a class="dropdown-item" href="../../../guides/terminology.html">
 <span class="dropdown-text">Course Terminology</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../guides/git-guide.html">
 <span class="dropdown-text">Git &amp; Github</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../guides/classroom-guide.html">
 <span class="dropdown-text">Github Classroom</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../../../guides/python-resources.html">
 <span class="dropdown-text">Python Resources</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item">
    <a class="nav-link" href="https://psyc201b.github.io/PSYC-201B/"> 
<span class="menu-text">Previous course versions</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
            <div class="quarto-navbar-tools">
    <a href="https://github.com/psyc-201/w26-201b" title="" class="quarto-navigation-tool px-1" aria-label=""><i class="bi bi-github"></i></a>
</div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" role="button" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../weeks/01/index.html">Week 1</a></li><li class="breadcrumb-item"><a href="../../../weeks/01/lab/polars-crash-course.html">Polars (dataframes) Crash Course</a></li></ol></nav>
        <a class="flex-grow-1" role="navigation" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
    </div>
  </nav>
  <div id="quarto-announcement" data-announcement-id="340ea895a18b7a7eec1fc2c3acdf2be5" class="alert alert-success hidden"><i class="bi bi-megaphone-fill quarto-announcement-icon"></i><div class="quarto-announcement-content">
<p><strong>Site Updates:</strong> Week 3 slides available.</p>
</div></div>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 1</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../weeks/01/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../weeks/01/lab/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">“Pre-flight” Lab Setup</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../weeks/01/lab/python-fundamentals.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Python Fundamentals</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../weeks/01/lab/polars-crash-course.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Polars (dataframes) Crash Course</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 2</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-2" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-2" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../weeks/02/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../weeks/02/lab/seaborn-crash-course.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Seaborn (plotting) Crash Course</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../weeks/02/lab/eda-workflows.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">EDA Workflows</span></a>
  </div>
</li>
      </ul>
  </li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true">
 <span class="menu-text">Week 3</span></a>
          <a class="sidebar-item-toggle text-start" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-3" role="navigation" aria-expanded="true" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-3" class="collapse list-unstyled sidebar-section depth1 show">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../../weeks/03/index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Overview</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#how-to-use-this-notebook" id="toc-how-to-use-this-notebook" class="nav-link active" data-scroll-target="#how-to-use-this-notebook">How to use this notebook</a></li>
  <li><a href="#how-to-import-polars" id="toc-how-to-import-polars" class="nav-link" data-scroll-target="#how-to-import-polars">How to import Polars</a></li>
  <li><a href="#why-use-polars" id="toc-why-use-polars" class="nav-link" data-scroll-target="#why-use-polars">Why use Polars?</a></li>
  <li><a href="#dataframe-fundamentals" id="toc-dataframe-fundamentals" class="nav-link" data-scroll-target="#dataframe-fundamentals">DataFrame fundamentals</a></li>
  <li><a href="#indexing-a-dataframe-for-simple-stuff-only" id="toc-indexing-a-dataframe-for-simple-stuff-only" class="nav-link" data-scroll-target="#indexing-a-dataframe-for-simple-stuff-only">Indexing a DataFrame (for simple stuff only!)</a></li>
  <li><a href="#thinking-in-polars-contexts-expressions" id="toc-thinking-in-polars-contexts-expressions" class="nav-link" data-scroll-target="#thinking-in-polars-contexts-expressions">Thinking in Polars: Contexts &amp; Expressions</a>
  <ul>
  <li><a href="#contexts" id="toc-contexts" class="nav-link" data-scroll-target="#contexts">Contexts</a>
  <ul class="collapse">
  <li><a href="#df.select---to-subset-columns" id="toc-df.select---to-subset-columns" class="nav-link" data-scroll-target="#df.select---to-subset-columns"><code>df.select()</code> - to <em>subset</em> columns</a></li>
  <li><a href="#df.with_columns---to-add-new-columns" id="toc-df.with_columns---to-add-new-columns" class="nav-link" data-scroll-target="#df.with_columns---to-add-new-columns"><code>df.with_columns()</code> - to <em>add</em> new columns</a></li>
  <li><a href="#df.filter---to-subset-rows" id="toc-df.filter---to-subset-rows" class="nav-link" data-scroll-target="#df.filter---to-subset-rows"><code>df.filter()</code> - to <em>subset</em> rows</a></li>
  <li><a href="#df.group_by.agg---to-summarize-by-group" id="toc-df.group_by.agg---to-summarize-by-group" class="nav-link" data-scroll-target="#df.group_by.agg---to-summarize-by-group"><code>df.group_by().agg()</code> - to <em>summarize</em> by group</a></li>
  </ul></li>
  <li><a href="#expressions" id="toc-expressions" class="nav-link" data-scroll-target="#expressions">Expressions</a></li>
  </ul></li>
  <li><a href="#starting-simple" id="toc-starting-simple" class="nav-link" data-scroll-target="#starting-simple">Starting simple</a></li>
  <li><a href="#selecting-columns-.select" id="toc-selecting-columns-.select" class="nav-link" data-scroll-target="#selecting-columns-.select">Selecting columns: <code>.select()</code></a>
  <ul>
  <li><a href="#expressing-multiple-things" id="toc-expressing-multiple-things" class="nav-link" data-scroll-target="#expressing-multiple-things">Expressing <em>multiple</em> things</a></li>
  <li><a href="#repeating-the-same-expression-across-many-columns" id="toc-repeating-the-same-expression-across-many-columns" class="nav-link" data-scroll-target="#repeating-the-same-expression-across-many-columns">Repeating the same expression across many columns</a></li>
  <li><a href="#renaming-expression-outputs" id="toc-renaming-expression-outputs" class="nav-link" data-scroll-target="#renaming-expression-outputs">Renaming expression outputs</a></li>
  </ul></li>
  <li><a href="#aggregating-columns-.group_by" id="toc-aggregating-columns-.group_by" class="nav-link" data-scroll-target="#aggregating-columns-.group_by">Aggregating columns: <code>.group_by()</code></a>
  <ul>
  <li><a href="#maintaining-group-order" id="toc-maintaining-group-order" class="nav-link" data-scroll-target="#maintaining-group-order">Maintaining group order</a></li>
  </ul></li>
  <li><a href="#creating-columns-.with_columns" id="toc-creating-columns-.with_columns" class="nav-link" data-scroll-target="#creating-columns-.with_columns">Creating columns: <code>.with_columns()</code></a></li>
  <li><a href="#selecting-rows-.filter" id="toc-selecting-rows-.filter" class="nav-link" data-scroll-target="#selecting-rows-.filter">Selecting rows: <code>.filter()</code></a></li>
  <li><a href="#missing-data-null-vs-nan" id="toc-missing-data-null-vs-nan" class="nav-link" data-scroll-target="#missing-data-null-vs-nan">Missing Data: <code>null</code> vs <code>NaN</code></a></li>
  <li><a href="#expressions-are-for-performing-operations" id="toc-expressions-are-for-performing-operations" class="nav-link" data-scroll-target="#expressions-are-for-performing-operations">Expressions are for performing <em>operations</em></a></li>
  <li><a href="#saving-re-usable-expressions" id="toc-saving-re-usable-expressions" class="nav-link" data-scroll-target="#saving-re-usable-expressions">Saving re-usable expressions</a></li>
  <li><a href="#more-complex-expression-with-functions-when-and-lit" id="toc-more-complex-expression-with-functions-when-and-lit" class="nav-link" data-scroll-target="#more-complex-expression-with-functions-when-and-lit">More complex expression with <em>functions</em>: <code>when</code> and <code>lit</code></a></li>
  <li><a href="#more-complex-expressions-with-attribute-type-operations" id="toc-more-complex-expressions-with-attribute-type-operations" class="nav-link" data-scroll-target="#more-complex-expressions-with-attribute-type-operations">More complex expressions with <em>attribute (type) operations</em></a></li>
  <li><a href="#building-expressions-from-additional-selectors" id="toc-building-expressions-from-additional-selectors" class="nav-link" data-scroll-target="#building-expressions-from-additional-selectors">Building expressions from additional <em>selectors</em></a></li>
  <li><a href="#reshaping-dataframes" id="toc-reshaping-dataframes" class="nav-link" data-scroll-target="#reshaping-dataframes">Reshaping DataFrames</a></li>
  <li><a href="#splitting-1-column-into-many" id="toc-splitting-1-column-into-many" class="nav-link" data-scroll-target="#splitting-1-column-into-many">Splitting 1 column into many</a></li>
  <li><a href="#combining-many-columns-into-1" id="toc-combining-many-columns-into-1" class="nav-link" data-scroll-target="#combining-many-columns-into-1">Combining many columns into 1</a></li>
  <li><a href="#your-turn" id="toc-your-turn" class="nav-link" data-scroll-target="#your-turn">Your Turn</a></li>
  <li><a href="#appendix" id="toc-appendix" class="nav-link" data-scroll-target="#appendix">Appendix</a>
  <ul>
  <li><a href="#additional-resources" id="toc-additional-resources" class="nav-link" data-scroll-target="#additional-resources">Additional Resources</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default"><nav class="quarto-page-breadcrumbs quarto-title-breadcrumbs d-none d-lg-block" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../../weeks/01/index.html">Week 1</a></li><li class="breadcrumb-item"><a href="../../../weeks/01/lab/polars-crash-course.html">Polars (dataframes) Crash Course</a></li></ol></nav>
<div class="quarto-title">
<h1 class="title">A Crash Course on Python DataFrames</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Eshin Jolly </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">January 7, 2026</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<p>In this tutorial we’ll build on your basic Python skills and immediately start working with a new kind of object: <code>DataFrame</code>. We’ll meet the first Python library we’ll use throughout the course <code>polars</code> and walkthrough all the basics in this notebook.</p>
<p><a href="https://docs.pola.rs/user-guide/getting-started/">Polars</a> is very <strong>user-friendly</strong> DataFrame library for working with <strong>structured data</strong> in Python, but also <a href="https://pola-rs.github.io/r-polars/">R</a> and other languages.</p>
<div class="callout callout-style-default callout-note callout-titled" title="An alternative Python library we won't use: pandas">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>An alternative Python library we won’t use: pandas
</div>
</div>
<div class="callout-body-container callout-body">
<p>As you learn more Python and grow your skills, you’ll come across or hear about <a href="https://pandas.pydata.org/docs/index.html">Pandas</a> probably the <em>most popular</em> library for working with DataFrames in Python. Many statistics courses will have you learn Pandas instead, given how long it’s been around and the wealth of materials available for learning it.</p>
<p>Unfortunately, Pandas is “showing its age” - it’s gone through so many changes and updates, that frankly even <em>Eshin</em> finds it difficult to keep up with the “right way” to do things in Pandas. Because Pandas meets so many different needs for so many different analysts (e.g.&nbsp;economics, finance, psych) - for the type of analyses we in Psych/Neuro/Cogsci are likely to perform on DataFrames - it <em>gets in the way</em> of learning and thinking.</p>
<p>Polars by comparison is quite a bit newer, but contains <em>all</em> the functionality you’ll need, while being much easier to wrap your head around. This will be a learning experience for both you <em>and</em> your instructors - but we strongly believe the alternatives will be unnecessarily challenging on your statistics journey.</p>
</div>
</div>
<section id="how-to-use-this-notebook" class="level2">
<h2 class="anchored" data-anchor-id="how-to-use-this-notebook">How to use this notebook</h2>
<p>This notebook is designed for you to work through at your own pace or use as a reference with other materials.</p>
<p>As you go through this notebook, you should regularly <strong>refer to the <a href="https://docs.pola.rs/api/python/stable/reference/index.html"><code>polars</code> documentation</a></strong> to look things up and general help. Try experimenting by creating new code cells and playing around with the demonstrated functionality.</p>
<p>Remember to use <code>help()</code> from <em>within</em> this notebook to look up how functionality works.</p>
</section>
<section id="how-to-import-polars" class="level2">
<h2 class="anchored" data-anchor-id="how-to-import-polars">How to import Polars</h2>
<p>We can make <code>polars</code> available by using the <code>import</code> statement. It’s convention to import <code>polars</code> in the following way:</p>
<div id="babb57f2" class="cell" data-execution_count="2">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars <span class="im">as</span> pl</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</section>
<section id="why-use-polars" class="level2">
<h2 class="anchored" data-anchor-id="why-use-polars">Why use Polars?</h2>
<p>So far we’ve made most use of Python <em>lists</em> and NumPy <em>arrays</em>. But in practice you’re probably working with some kind of <strong>structured data</strong>, i.e.&nbsp;spreadsheet-style data with columns and rows</p>
<p><img src="figs/01_table_spreadsheet.png" class="img-fluid" style="width:50.0%"></p>
<p>In Polars we call this a <code>DataFrame</code>, a 2d table with rows and columns of different types of data (e.g.&nbsp;strings, numbers, etc).</p>
<p><img src="figs/01_table_dataframe.svg" class="img-fluid" style="width:40.0%"></p>
<p>Each <strong>column</strong> of a <code>DataFrame</code> contains the same <strong>type</strong> of data. Let’s look at an example by loading a file with the <code>pl.read_csv()</code> function.</p>
<p>This will return a <code>DataFrame</code> we can check out:</p>
<div id="7fa800e2" class="cell" data-execution_count="3">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>df <span class="op">=</span> pl.read_csv(<span class="st">'data/example.csv'</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="2">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Sex</th>
</tr>
<tr class="even">
<td>str</td>
<td>i64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Braund, Mr. Owen Harris"</td>
<td>22</td>
<td>"male"</td>
</tr>
<tr class="even">
<td>"Allen, Mr. William Henry"</td>
<td>35</td>
<td>"male"</td>
</tr>
<tr class="odd">
<td>"Bonnell, Miss. Elizabeth"</td>
<td>58</td>
<td>"female"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Notice how Polars tells us the <strong>type</strong> of each column below it’s name.</p>
</section>
<section id="dataframe-fundamentals" class="level2">
<h2 class="anchored" data-anchor-id="dataframe-fundamentals">DataFrame fundamentals</h2>
<p>We can get basic information about a DataFrame by accessing its <strong><a href="https://docs.pola.rs/api/python/stable/reference/dataframe/attributes.html">attributes</a></strong> using <code>.</code> syntax <em>without</em> <code>()</code> at the end:</p>
<div id="fa4bca19" class="cell" data-execution_count="4">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>df.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="3">
<pre><code>(3, 3)</code></pre>
</div>
</div>
<div id="c00cef06" class="cell" data-execution_count="5">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>df.height</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="4">
<pre><code>3</code></pre>
</div>
</div>
<div id="1363e303" class="cell" data-execution_count="6">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>df.width</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="5">
<pre><code>3</code></pre>
</div>
</div>
<div id="a9f40af2" class="cell" data-execution_count="7">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>df.columns</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="6">
<pre><code>['Name', 'Age', 'Sex']</code></pre>
</div>
</div>
<p>DataFrames have various <strong><a href="https://docs.pola.rs/api/python/stable/reference/dataframe/modify_select.html">methods</a></strong> that we can use with <code>.</code> syntax <em>with</em> a <code>()</code> at the end.</p>
<p>Remember that <em>methods</em> in Python are just <em>functions</em> that “belong” to some object. In this case these methods “belong” to a <code>DataFrame</code> object and can take arguments that operate on it.</p>
<p>Some might be familiar from R or other languages:</p>
<p><code>.head()</code> gives us the first few rows. Since we only have 3 rows, we can pass an argument to the method to as for the first 2:</p>
<div id="287187eb" class="cell" data-execution_count="8">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>df.head(<span class="dv">2</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="7">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Sex</th>
</tr>
<tr class="even">
<td>str</td>
<td>i64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Braund, Mr. Owen Harris"</td>
<td>22</td>
<td>"male"</td>
</tr>
<tr class="even">
<td>"Allen, Mr. William Henry"</td>
<td>35</td>
<td>"male"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>And <code>.tail()</code> is the opposite:</p>
<div id="9bee84f2" class="cell" data-execution_count="9">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>df.tail(<span class="dv">2</span>) <span class="co"># last 2 rows</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="8">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Sex</th>
</tr>
<tr class="even">
<td>str</td>
<td>i64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Allen, Mr. William Henry"</td>
<td>35</td>
<td>"male"</td>
</tr>
<tr class="even">
<td>"Bonnell, Miss. Elizabeth"</td>
<td>58</td>
<td>"female"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can use <code>.glimpse()</code> to <em>transpose</em> a DataFrame. This can sometimes make it easier to see the column names listed as <em>rows</em> and the values listed as <em>columns</em>:</p>
<div id="fc5fcd80" class="cell" data-execution_count="10">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>df.glimpse()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 3
Columns: 3
$ Name &lt;str&gt; 'Braund, Mr. Owen Harris', 'Allen, Mr. William Henry', 'Bonnell, Miss. Elizabeth'
$ Age  &lt;i64&gt; 22, 35, 58
$ Sex  &lt;str&gt; 'male', 'male', 'female'
</code></pre>
</div>
</div>
<p>And <code>.describe()</code> to get some quick summary stats:</p>
<div id="0a2e7e64" class="cell" data-execution_count="11">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>df.describe()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="10">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (9, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">statistic</th>
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Sex</th>
</tr>
<tr class="even">
<td>str</td>
<td>str</td>
<td>f64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"count"</td>
<td>"3"</td>
<td>3.0</td>
<td>"3"</td>
</tr>
<tr class="even">
<td>"null_count"</td>
<td>"0"</td>
<td>0.0</td>
<td>"0"</td>
</tr>
<tr class="odd">
<td>"mean"</td>
<td>null</td>
<td>38.333333</td>
<td>null</td>
</tr>
<tr class="even">
<td>"std"</td>
<td>null</td>
<td>18.230012</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"min"</td>
<td>"Allen, Mr. William Henry"</td>
<td>22.0</td>
<td>"female"</td>
</tr>
<tr class="even">
<td>"25%"</td>
<td>null</td>
<td>35.0</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"50%"</td>
<td>null</td>
<td>35.0</td>
<td>null</td>
</tr>
<tr class="even">
<td>"75%"</td>
<td>null</td>
<td>58.0</td>
<td>null</td>
</tr>
<tr class="odd">
<td>"max"</td>
<td>"Braund, Mr. Owen Harris"</td>
<td>58.0</td>
<td>"male"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>There are many additional <a href="https://docs.pola.rs/api/python/stable/reference/dataframe/aggregation.html">methods to calculate statistics</a> as well. But we’ll revisit these later:</p>
<div id="cea42323" class="cell" data-execution_count="12">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>df.mean()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="11">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Sex</th>
</tr>
<tr class="even">
<td>str</td>
<td>f64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>null</td>
<td>38.333333</td>
<td>null</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="032fad19" class="cell" data-execution_count="13">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>df.<span class="bu">min</span>()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="12">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Sex</th>
</tr>
<tr class="even">
<td>str</td>
<td>i64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Allen, Mr. William Henry"</td>
<td>22</td>
<td>"female"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>DataFrames also have a <a href="https://docs.pola.rs/api/python/stable/reference/dataframe/api/polars.DataFrame.sample.html#polars.DataFrame.sample"><code>.sample()</code> method</a> that allows you <strong>resample</strong> rows from the DataFrame with or without replacement.</p>
<p>You can tell Polars to sample <em>all rows</em> without replacement, aka <strong>permuting</strong>:</p>
<div id="5e029222" class="cell" data-execution_count="14">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb18"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>df.sample(fraction<span class="op">=</span><span class="dv">1</span>, shuffle<span class="op">=</span><span class="va">True</span>, with_replacement<span class="op">=</span><span class="va">False</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="13">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Sex</th>
</tr>
<tr class="even">
<td>str</td>
<td>i64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Bonnell, Miss. Elizabeth"</td>
<td>58</td>
<td>"female"</td>
</tr>
<tr class="even">
<td>"Allen, Mr. William Henry"</td>
<td>35</td>
<td>"male"</td>
</tr>
<tr class="odd">
<td>"Braund, Mr. Owen Harris"</td>
<td>22</td>
<td>"male"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Or resample <em>with</em> replacement, aka <strong>bootstrapping</strong>:</p>
<div id="7bd45abe" class="cell" data-execution_count="15">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>df.sample(fraction<span class="op">=</span><span class="dv">1</span>, shuffle<span class="op">=</span><span class="va">True</span>, with_replacement<span class="op">=</span><span class="va">True</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="14">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Sex</th>
</tr>
<tr class="even">
<td>str</td>
<td>i64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Bonnell, Miss. Elizabeth"</td>
<td>58</td>
<td>"female"</td>
</tr>
<tr class="even">
<td>"Allen, Mr. William Henry"</td>
<td>35</td>
<td>"male"</td>
</tr>
<tr class="odd">
<td>"Braund, Mr. Owen Harris"</td>
<td>22</td>
<td>"male"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>These methods will be handy when we cover resampling statistics later in the course.</p>
</section>
<section id="indexing-a-dataframe-for-simple-stuff-only" class="level2">
<h2 class="anchored" data-anchor-id="indexing-a-dataframe-for-simple-stuff-only">Indexing a DataFrame (for simple stuff only!)</h2>
<p>Because a DataFrame is a 2d table, we can use the same <em>indexing</em> and <em>slicing</em> syntax but in 2d for <strong>rows</strong> and <strong>columns</strong>.</p>
<p>Remember these are <strong>0-indexed</strong>: the first row/col is at position 0, not position 1</p>
<p>If this is our DataFrame:</p>
<div id="8ef05f71" class="cell" data-execution_count="16">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb20"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>df</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="15">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Name</th>
<th data-quarto-table-cell-role="th">Age</th>
<th data-quarto-table-cell-role="th">Sex</th>
</tr>
<tr class="even">
<td>str</td>
<td>i64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Braund, Mr. Owen Harris"</td>
<td>22</td>
<td>"male"</td>
</tr>
<tr class="even">
<td>"Allen, Mr. William Henry"</td>
<td>35</td>
<td>"male"</td>
</tr>
<tr class="odd">
<td>"Bonnell, Miss. Elizabeth"</td>
<td>58</td>
<td>"female"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can slice it like this:</p>
<div id="f574d498" class="cell" data-execution_count="17">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 row index = 1st row</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1 col index = 2nd col (age)</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">0</span>, <span class="dv">1</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="16">
<pre><code>22</code></pre>
</div>
</div>
<p>And of course we can slice using <code>start:stop:step</code>, which is always <strong>up-to</strong> the end value we slice to:</p>
<div id="d5abb94d" class="cell" data-execution_count="18">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 0:2 slice = rows up to, but not including 2 - just 0, 1</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 0 col index = 1st col (name)</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">0</span>:<span class="dv">2</span>,<span class="dv">0</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="17">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Name</th>
</tr>
<tr class="even">
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Braund, Mr. Owen Harris"</td>
</tr>
<tr class="even">
<td>"Allen, Mr. William Henry"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can also using slicing syntax to quickly refer to columns by name:</p>
<div id="40117f89" class="cell" data-execution_count="19">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All rows in column 'Name'</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>df[<span class="st">'Name'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="18">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Name</th>
</tr>
<tr class="even">
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Braund, Mr. Owen Harris"</td>
</tr>
<tr class="even">
<td>"Allen, Mr. William Henry"</td>
</tr>
<tr class="odd">
<td>"Bonnell, Miss. Elizabeth"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Which is equivalent to:</p>
<div id="95322e37" class="cell" data-execution_count="20">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Explicitly slice 'all' rows</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 'Name' = just the Name column</span></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a>df[:, <span class="st">'Name'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="19">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3,)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Name</th>
</tr>
<tr class="even">
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Braund, Mr. Owen Harris"</td>
</tr>
<tr class="even">
<td>"Allen, Mr. William Henry"</td>
</tr>
<tr class="odd">
<td>"Bonnell, Miss. Elizabeth"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="2c3e194e" class="cell" data-execution_count="21">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 0:2 slice = rows up to, but not including 2</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 'Name' = just the Name column</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>df[<span class="dv">0</span>:<span class="dv">2</span>, <span class="st">'Name'</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="20">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2,)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">Name</th>
</tr>
<tr class="even">
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"Braund, Mr. Owen Harris"</td>
</tr>
<tr class="even">
<td>"Allen, Mr. William Henry"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>While you <em>can</em> access values this way, what makes Polars powerful is that it offers a much <em>richer</em> “language” or set of “patterns” for working with DataFrames, like <code>dplyr</code>’s <em>verbs</em> in R’s Tidyverse.</p>
<p>While it doesn’t map on one-to-one, Polars offers a <em>consistent</em> and <em>intuitive</em> way of working with DataFrames that we’ll teach you in this notebook. Once the fundamentals “click” for you, you’ll be a data manipulating ninja!</p>
</div>
</div>
</section>
<section id="thinking-in-polars-contexts-expressions" class="level2">
<h2 class="anchored" data-anchor-id="thinking-in-polars-contexts-expressions">Thinking in Polars: Contexts &amp; Expressions</h2>
<p>To understand how to “think” in polars, we need to understand 2 fundamental concepts: <strong>contexts</strong> and <strong>expressions</strong></p>
<p>A <strong>context</strong> in Polars is how you <strong>choose what data</strong> you want to operate on. There are only a few you’ll use regularly:</p>
<section id="contexts" class="level3">
<h3 class="anchored" data-anchor-id="contexts">Contexts</h3>
<section id="df.select---to-subset-columns" class="level4">
<h4 class="anchored" data-anchor-id="df.select---to-subset-columns"><code>df.select()</code> - to <em>subset</em> columns</h4>
<p><img src="figs/03_subset_columns.svg" class="img-fluid" style="width:50.0%"></p>
</section>
<section id="df.with_columns---to-add-new-columns" class="level4">
<h4 class="anchored" data-anchor-id="df.with_columns---to-add-new-columns"><code>df.with_columns()</code> - to <em>add</em> new columns</h4>
<p><img src="figs/05_newcolumn_1.svg" class="img-fluid" style="width:50.0%"></p>
</section>
<section id="df.filter---to-subset-rows" class="level4">
<h4 class="anchored" data-anchor-id="df.filter---to-subset-rows"><code>df.filter()</code> - to <em>subset</em> rows</h4>
<p><img src="figs/03_subset_rows.svg" class="img-fluid" style="width:50.0%"></p>
</section>
<section id="df.group_by.agg---to-summarize-by-group" class="level4">
<h4 class="anchored" data-anchor-id="df.group_by.agg---to-summarize-by-group"><code>df.group_by().agg()</code> - to <em>summarize</em> by group</h4>
<p><img src="figs/06_groupby.svg" class="img-fluid" style="width:50.0%"></p>
</section>
</section>
<section id="expressions" class="level3">
<h3 class="anchored" data-anchor-id="expressions">Expressions</h3>
<p>An <strong>expression</strong> is any computation we do <em>inside</em> of a context.</p>
<p>To build an expression we first use a <em>selector</em> to choose one or more columns.</p>
<p>The most common <em>selector</em> you’ll use is <code>pl.col()</code> to select one or more columns by name.</p>
<p>Then we used <em>method-chaining</em>, <code>.</code> syntax, to perform <em>operations</em> on the selected columns.</p>
<p>Let’s see a simple example.</p>
</section>
</section>
<section id="starting-simple" class="level2">
<h2 class="anchored" data-anchor-id="starting-simple">Starting simple</h2>
<p>Let’s say we have data from some experiment that contains 3 participants, each of whom made 5 judgments about some stimuli.</p>
<p>We can use the <code>pl.read_csv()</code> function to load a file and get back a polars <code>DataFrame</code>:</p>
<div id="4a7ff4a7" class="cell" data-execution_count="22">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>df_1 <span class="op">=</span> pl.read_csv(<span class="st">'data/example_2.csv'</span>)</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>df_1</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="21">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>70</td>
<td>439.524973</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>55.11928</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>644.801272</td>
</tr>
<tr class="even">
<td>3</td>
<td>12</td>
<td>571.800553</td>
</tr>
<tr class="odd">
<td>3</td>
<td>58</td>
<td>715.224208</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can verify there are 15 rows and 3 columns:</p>
<div id="a8a2cb4f" class="cell" data-execution_count="23">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>df_1.shape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="22">
<pre><code>(15, 3)</code></pre>
</div>
</div>
</section>
<section id="selecting-columns-.select" class="level2">
<h2 class="anchored" data-anchor-id="selecting-columns-.select">Selecting columns: <code>.select()</code></h2>
<p>The <code>.select</code> <strong>context</strong> is what you’ll use most often. It lets you apply <strong>expressions</strong> only to the specific columns you select.</p>
<p><img src="figs/03_subset_columns.svg" class="img-fluid" style="width:50.0%"></p>
<p>Here’s a simple example. Let’s say we want to calculate the <em>average</em> of the accuracy column.</p>
<p>How would we start?</p>
<p>First, we need to think about our <strong>context</strong>. Since we only want the “accuracy” column we can use <code>.select()</code>.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>df.select(                     <span class="co"># &lt;- this is our context</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Second, we need to create an <strong>expression</strong> that means: “use the <em>accuracy</em> column, and calculate it’s <em>mean</em>”.</p>
<p>We can create an <strong>expression</strong> by combining the <em>selector</em> <code>pl.col()</code> with the <em>operation</em> <code>.mean()</code> using <code>.</code> syntax, i.e.&nbsp;method-chaining.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a>df.select(                     <span class="co"># &lt;- this is our context</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>  pl.col(<span class="st">'accuracy'</span>).mean()   <span class="co"># &lt;- this is an expression, inside this context</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Let’s try this now:</p>
<div id="5802bb69" class="cell" data-execution_count="24">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start of context</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>df_1.select(</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    pl.col(<span class="st">'accuracy'</span>).mean() <span class="co"># &lt;- this is our expression</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a><span class="co"># end of context</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="23">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 1)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">accuracy</th>
</tr>
<tr class="even">
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>56.066667</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Indentation within polars context does not matter">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Indentation within polars context does not matter
</div>
</div>
<div class="callout-body-container callout-body">
<p>In this examples throughout this notebook you’ll see that we split up expressions over multiple lines within a <code>polars</code> context. You <strong>do not</strong> have to do this as indentation does not matter between the <code>()</code> We’re just trying to keep things a bit more readable for you. But the following code is exactly the same as the cell above:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>df_1.select(pl.col(<span class="st">'accuracy'</span>).mean())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<p>How would you build expression to calculate the “median” Reaction Time?</p>
</div>
</div>
<div id="df30c3fe" class="cell" data-execution_count="25">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>df_1.select()  <span class="co"># put your expression here!</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-5-contents" aria-controls="callout-5" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-5" class="callout-5-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="bb3d6444" class="cell" data-execution_count="26">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>df_1.select(pl.col(<span class="st">'rt'</span>).median())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="24">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 1)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>502.974663</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p>Let’s make our lives a bit easier and type less by using what we know about <code>import</code> from the previous tutorials:</p>
<div id="5e487baf" class="cell" data-execution_count="27">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># now we can use col() instead of pl.col()</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> polars <span class="im">import</span> col</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>Now we can use <code>col</code> in place of <code>pl.col</code></p>
<section id="expressing-multiple-things" class="level3">
<h3 class="anchored" data-anchor-id="expressing-multiple-things">Expressing <em>multiple</em> things</h3>
<p>We can add as many <strong>expressions</strong> inside a <strong>context</strong> as we want. We just need to separate them with a <code>,</code>.</p>
<p>Each the result from each <strong>expression</strong> will be saved to a separate column.</p>
<p>We’ll use the <code>col()</code> <em>selector</em> again to perform two different <em>operations</em>: <code>n_unique()</code> and <code>mean()</code> on two different columns:</p>
<div id="99118c51" class="cell" data-execution_count="28">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start context</span></span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>df_1.select(</span>
<span id="cb37-3"><a href="#cb37-3" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'participant'</span>).n_unique(), col(<span class="st">'accuracy'</span>).mean() <span class="co"># &lt;- multiple expressions separate by ,</span></span>
<span id="cb37-4"><a href="#cb37-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb37-5"><a href="#cb37-5" aria-hidden="true" tabindex="-1"></a><span class="co"># end context</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="26">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
</tr>
<tr class="even">
<td>u32</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
<td>56.066667</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<p>How would you express the following statement in polars?</p>
<p><em>Select only the participant and accuracy columns</em></p>
<p><em>For each participant, calculate the number of values, i.e.&nbsp;<code>.count()</code></em></p>
<p><em>For accuracy, calculate its standard deviation (what method do you think it is?)</em></p>
</div>
</div>
<div id="73edaffa" class="cell" data-execution_count="29">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 1) Use the .select() context</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 2) Use col() to create 2 expressions separated by a comma</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-7-contents" aria-controls="callout-7" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-7" class="callout-7-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="60ad19c3" class="cell" data-execution_count="30">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>df_1.select(</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'participant'</span>).count(),</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'accuracy'</span>).std()</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="27">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
</tr>
<tr class="even">
<td>u32</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>15</td>
<td>27.043528</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="repeating-the-same-expression-across-many-columns" class="level3">
<h3 class="anchored" data-anchor-id="repeating-the-same-expression-across-many-columns">Repeating the same expression across many columns</h3>
<p>Sometimes we might find ourselves <em>repeating</em> the same <strong>expression</strong> for different columns.</p>
<p>One way we can do that is simply by creating <strong>multiple expressions</strong> like by before, by using <code>col()</code> to <em>select</em> each column separately:</p>
<div id="ec311262" class="cell" data-execution_count="31">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>df_1.select(</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'accuracy'</span>).median(), col(<span class="st">'rt'</span>).median()</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="28">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>64.0</td>
<td>502.974663</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>But Polars makes this much easier for us - we can condense this down to a <strong>single expression</strong> by giving our <em>selector</em> - <code>col()</code> - additional column names:</p>
<div id="3fc0bb56" class="cell" data-execution_count="32">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>df_1.select(col(<span class="st">'accuracy'</span>, <span class="st">'rt'</span>).median())  <span class="co"># &lt;- one expression repeated for both columns</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="29">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>64.0</td>
<td>502.974663</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>These both do the same thing so if you find it helpful to start <em>explicit</em>, building up each expression one at a time, feel free to do that!</p>
<p>Later on you might find it helpful to use a single condensed expression, when you find yourself getting annoyed by repeating yourself.</p>
</section>
<section id="renaming-expression-outputs" class="level3">
<h3 class="anchored" data-anchor-id="renaming-expression-outputs">Renaming expression outputs</h3>
<p>Let’s try creating two expressions that operate on the same column. In natural language:</p>
<p>“<em>Select</em> only the accuracy column. For accuracy, calculate its <em>median</em> For accuracy, calculate its <em>variance</em>”</p>
<p>Let’s try it:</p>
<div id="8c5a3fb2" class="cell" data-execution_count="33">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>df_1.select(col(<span class="st">'accuracy'</span>).mean(), col(<span class="st">'accuracy'</span>).std())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">DuplicateError</span>                            Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[30]</span><span class="ansi-green-fg">, line 1</span>
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">1</span> <span class="ansi-yellow-bg">df_1</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">select</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">col</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-fg ansi-yellow-bg">accuracy</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">mean</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">col</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-fg ansi-yellow-bg">accuracy</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">std</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/Dropbox/docs/teaching/201b/w26/.venv/lib/python3.11/site-packages/polars/dataframe/frame.py:10150</span>, in <span class="ansi-cyan-fg">DataFrame.select</span><span class="ansi-blue-fg">(self, *exprs, **named_exprs)</span>
<span class="ansi-green-fg">  10066</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">  10067</span> <span style="font-style:italic" class="ansi-yellow-fg">Select columns from this DataFrame.</span>
<span class="ansi-green-fg">  10068</span> 
<span class="ansi-green-fg">   (...)</span><span class="ansi-green-fg">  10143</span> <span style="font-style:italic" class="ansi-yellow-fg">└───────────┘</span>
<span class="ansi-green-fg">  10144</span> <span style="font-style:italic" class="ansi-yellow-fg">"""</span>
<span class="ansi-green-fg">  10145</span> <span style="font-weight:bold;color:rgb(0,135,0)">from</span><span style="color:rgb(188,188,188)"> </span><span class="ansi-blue-fg ansi-bold">polars</span><span class="ansi-blue-fg ansi-bold">.</span><span class="ansi-blue-fg ansi-bold">lazyframe</span><span class="ansi-blue-fg ansi-bold">.</span><span class="ansi-blue-fg ansi-bold">opt_flags</span><span style="color:rgb(188,188,188)"> </span><span style="font-weight:bold;color:rgb(0,135,0)">import</span> QueryOptFlags
<span class="ansi-green-fg">  10147</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> (
<span class="ansi-green-fg">  10148</span>     <span style="color:rgb(0,135,0)" class="ansi-yellow-bg">self</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">lazy</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">  10149</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">select</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">exprs</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">named_exprs</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">&gt; </span><span class="ansi-green-fg">10150</span> <span class="ansi-yellow-bg">    </span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">collect</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">optimizations</span><span class="ansi-yellow-bg">=</span><span class="ansi-yellow-bg">QueryOptFlags</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">_eager</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">)</span>
<span class="ansi-green-fg">  10151</span> )

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/Dropbox/docs/teaching/201b/w26/.venv/lib/python3.11/site-packages/polars/_utils/deprecation.py:97</span>, in <span class="ansi-cyan-fg">deprecate_streaming_parameter.&lt;locals&gt;.decorate.&lt;locals&gt;.wrapper</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-fg">     93</span>         kwargs[<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">engine</span><span class="ansi-yellow-fg">"</span>] = <span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">in-memory</span><span class="ansi-yellow-fg">"</span>
<span class="ansi-green-fg">     95</span>     <span style="font-weight:bold;color:rgb(0,135,0)">del</span> kwargs[<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">streaming</span><span class="ansi-yellow-fg">"</span>]
<span class="ansi-green-fg">---&gt; </span><span class="ansi-green-fg">97</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">function</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/Dropbox/docs/teaching/201b/w26/.venv/lib/python3.11/site-packages/polars/lazyframe/opt_flags.py:328</span>, in <span class="ansi-cyan-fg">forward_old_opt_flags.&lt;locals&gt;.decorate.&lt;locals&gt;.wrapper</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-fg">    325</span>         optflags = cb(optflags, kwargs.pop(key))  <span style="font-style:italic;color:rgb(95,135,135)"># type: ignore[no-untyped-call,unused-ignore]</span>
<span class="ansi-green-fg">    327</span> kwargs[<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">optimizations</span><span class="ansi-yellow-fg">"</span>] = optflags
<span class="ansi-green-fg">--&gt; </span><span class="ansi-green-fg">328</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> <span class="ansi-yellow-bg">function</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">args</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">*</span><span class="ansi-yellow-bg">kwargs</span><span class="ansi-yellow-bg">)</span>

<span class="ansi-cyan-fg">File </span><span class="ansi-green-fg">~/Dropbox/docs/teaching/201b/w26/.venv/lib/python3.11/site-packages/polars/lazyframe/frame.py:2429</span>, in <span class="ansi-cyan-fg">LazyFrame.collect</span><span class="ansi-blue-fg">(self, type_coercion, predicate_pushdown, projection_pushdown, simplify_expression, slice_pushdown, comm_subplan_elim, comm_subexpr_elim, cluster_with_columns, collapse_joins, no_optimization, engine, background, optimizations, **_kwargs)</span>
<span class="ansi-green-fg">   2427</span> <span style="font-style:italic;color:rgb(95,135,135)"># Only for testing purposes</span>
<span class="ansi-green-fg">   2428</span> callback = _kwargs.get(<span class="ansi-yellow-fg">"</span><span class="ansi-yellow-fg">post_opt_callback</span><span class="ansi-yellow-fg">"</span>, callback)
<span class="ansi-green-fg">-&gt; </span><span class="ansi-green-fg">2429</span> <span style="font-weight:bold;color:rgb(0,135,0)">return</span> wrap_df(<span class="ansi-yellow-bg">ldf</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">collect</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-bg">engine</span><span class="ansi-yellow-bg">,</span><span class="ansi-yellow-bg"> </span><span class="ansi-yellow-bg">callback</span><span class="ansi-yellow-bg">)</span>)

<span class="ansi-red-fg">DuplicateError</span>: projections contained duplicate output name 'accuracy'. It's possible that multiple expressions are returning the same default column name. If this is the case, try renaming the columns with `.alias("new_name")` to avoid duplicate column names.</pre>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled" title="polars DuplicateError">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Important</span>polars DuplicateError
</div>
</div>
<div class="callout-body-container callout-body">
<p>Polars automatically enforces the requirement that <em>all column names are must be unique</em>.</p>
<p>By default the results of an <strong>expression</strong> are saved using the same column name that you <em>selected</em>.</p>
<p>In this case we <em>selected</em> “accuracy” using <code>col('accuracy')</code> twice - once to calculate the mean and once to calculate the standard deviation. So Polars is trying to save both results into a column called <em>accuracy</em> causing a conflict!</p>
<p>To fix this, we can <em>extend</em> our <strong>expression</strong> with additional <em>operations</em> using method-chaining with the <code>.</code> syntax.</p>
<p>The operation we’re looking for is <code>.alias()</code> which you’ll often put at the <em>end</em> of an expression in order to give it a <em>new name</em></p>
</div>
</div>
<div id="338bc9ea" class="cell" data-execution_count="34">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a>df_1.select(</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'accuracy'</span>).mean().alias(<span class="st">'acc_mean'</span>),</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'accuracy'</span>).std().alias(<span class="st">'acc_std'</span>)</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="31">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">acc_mean</th>
<th data-quarto-table-cell-role="th">acc_std</th>
</tr>
<tr class="even">
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>56.066667</td>
<td>27.043528</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Two styles of expressing yourself">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Two styles of expressing yourself
</div>
</div>
<div class="callout-body-container callout-body">
<p>You might find this style of “method-chaining” the use of <code>.alias()</code> unintuitive at first. So Polars also lets your rename your expressions in a different “style” using <code>=</code> as in other language like R.</p>
<p>In English, we could rephrase our expressions as so:</p>
<p><em>Select the accuracy column</em> <em>Create a new column named ‘acc_mean’, which is the mean of accuracy</em> <em>Create a new column named ‘acc_std’, which is the standard-deviation of accuracy</em></p>
<p>And in code like this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>df_1.select(</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>    acc_mean <span class="op">=</span> col(<span class="st">'accuracy'</span>).mean(),</span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>    acc_std <span class="op">=</span> col(<span class="st">'accuracy'</span>).std()</span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You can use which ever style of “phrasing” an expression that feels more natural to you based on what you’re doing!</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Your turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Your turn
</div>
</div>
<div class="callout-body-container callout-body">
<p>Run the following code. Why are the values in the accuracy column being overwritten? Can you fix it?</p>
</div>
</div>
<div id="4d988ddf" class="cell" data-execution_count="35">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>df_1.select(col(<span class="st">'participant'</span>), col(<span class="st">'accuracy'</span>).mean())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="32">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
</tr>
<tr class="even">
<td>i64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>56.066667</td>
</tr>
<tr class="even">
<td>1</td>
<td>56.066667</td>
</tr>
<tr class="odd">
<td>1</td>
<td>56.066667</td>
</tr>
<tr class="even">
<td>1</td>
<td>56.066667</td>
</tr>
<tr class="odd">
<td>1</td>
<td>56.066667</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>56.066667</td>
</tr>
<tr class="even">
<td>3</td>
<td>56.066667</td>
</tr>
<tr class="odd">
<td>3</td>
<td>56.066667</td>
</tr>
<tr class="even">
<td>3</td>
<td>56.066667</td>
</tr>
<tr class="odd">
<td>3</td>
<td>56.066667</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-11-contents" aria-controls="callout-11" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-11" class="callout-11-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<p>The mean of accuracy is being saved to a column named “accuracy” which overwrites the participant values being selected. Fix by renaming:</p>
<div id="bbcac868" class="cell" data-execution_count="36">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a>df_1.select(col(<span class="st">'participant'</span>), col(<span class="st">'accuracy'</span>).mean().alias(<span class="st">'acc_mean'</span>))</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Or equivalently:</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="co"># df_1.select(col('participant'), acc_mean=col('accuracy').mean())</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="33">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">acc_mean</th>
</tr>
<tr class="even">
<td>i64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>56.066667</td>
</tr>
<tr class="even">
<td>1</td>
<td>56.066667</td>
</tr>
<tr class="odd">
<td>1</td>
<td>56.066667</td>
</tr>
<tr class="even">
<td>1</td>
<td>56.066667</td>
</tr>
<tr class="odd">
<td>1</td>
<td>56.066667</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>56.066667</td>
</tr>
<tr class="even">
<td>3</td>
<td>56.066667</td>
</tr>
<tr class="odd">
<td>3</td>
<td>56.066667</td>
</tr>
<tr class="even">
<td>3</td>
<td>56.066667</td>
</tr>
<tr class="odd">
<td>3</td>
<td>56.066667</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="aggregating-columns-.group_by" class="level2">
<h2 class="anchored" data-anchor-id="aggregating-columns-.group_by">Aggregating columns: <code>.group_by()</code></h2>
<p>The <code>.group_by('some_col')</code> context is used for <strong>summarizing</strong> columns separately by <code>'some_col'</code>.</p>
<p><img src="figs/06_groupby.svg" class="img-fluid" style="width:50.0%"></p>
<p>You always follow up a <code>.group_by()</code> with <code>.agg()</code>, and place our <strong>expressions</strong> inside to tell Polars what should be calculated per group.</p>
<p>Using <code>.group_by()</code> will <strong>always</strong> give you a <strong>smaller</strong> DataFrame than the original. Specifically you will get back a DataFrame whose rows = number of groups</p>
<div id="fc0cccc3" class="cell" data-execution_count="37">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start of .agg context</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>df_1.group_by(<span class="st">'participant'</span>).agg(</span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'rt'</span>).mean(), col(<span class="st">'accuracy'</span>).mean() <span class="co"># &lt;- expressions like before</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="34">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">accuracy</th>
</tr>
<tr class="even">
<td>i64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>573.523797</td>
<td>57.8</td>
</tr>
<tr class="even">
<td>2</td>
<td>496.969382</td>
<td>47.2</td>
</tr>
<tr class="odd">
<td>3</td>
<td>485.294057</td>
<td>63.2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<section id="maintaining-group-order" class="level3">
<h3 class="anchored" data-anchor-id="maintaining-group-order">Maintaining group order</h3>
<p>Unfortunately, by default Polars doesn’t preserve the <em>order</em> of groups as they exist in the original DataFrame. But we can easily fix this by giving <code>.group_by()</code> and additional argument <code>maintain_order=True</code>:</p>
<div id="0f8828a6" class="cell" data-execution_count="38">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>df_1.group_by(<span class="st">'participant'</span>, maintain_order<span class="op">=</span><span class="va">True</span>).agg(</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'rt'</span>).mean(), col(<span class="st">'accuracy'</span>).mean()</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="35">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">accuracy</th>
</tr>
<tr class="even">
<td>i64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>573.523797</td>
<td>57.8</td>
</tr>
<tr class="even">
<td>2</td>
<td>496.969382</td>
<td>47.2</td>
</tr>
<tr class="odd">
<td>3</td>
<td>485.294057</td>
<td>63.2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<p>Calculate each participant’s average <em>reaction time</em> divided by their average <em>accuracy</em>. Remember since there are just 3 unique participants, i.e.&nbsp;3 “groups”, our result should have <strong>3 rows</strong>; one for each participant.</p>
<p><em>Hint: you can divide 2 columns using the method-chaining style with <a href="https://docs.pola.rs/api/python/dev/reference/expressions/api/polars.Expr.truediv.html"><code>.truediv()</code></a> or simply using <code>/</code></em></p>
</div>
</div>
<div id="834122f8" class="cell" data-execution_count="39">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Hint: use group_by on 'participant' and then create an expression</span></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="co"># that divides the average 'rt' by average 'accuracy' and name it 'rt_acc_avg'</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-13-contents" aria-controls="callout-13" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-13" class="callout-13-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="551f5d71" class="cell" data-execution_count="40">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>df_1.group_by(<span class="st">'participant'</span>, maintain_order<span class="op">=</span><span class="va">True</span>).agg(</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>    rt_acc_avg <span class="op">=</span> col(<span class="st">'rt'</span>).mean() <span class="op">/</span> col(<span class="st">'accuracy'</span>).mean()</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="36">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">rt_acc_avg</th>
</tr>
<tr class="even">
<td>i64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>9.922557</td>
</tr>
<tr class="even">
<td>2</td>
<td>10.529012</td>
</tr>
<tr class="odd">
<td>3</td>
<td>7.678703</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
</section>
<section id="creating-columns-.with_columns" class="level2">
<h2 class="anchored" data-anchor-id="creating-columns-.with_columns">Creating columns: <code>.with_columns()</code></h2>
<p>Whenever we want to return the original DataFrame along with some <strong>new columns</strong> we can use the <code>.with_columns</code> context instead of <code>.select</code>.</p>
<p><img src="figs/05_newcolumn_1.svg" class="img-fluid" style="width:50.0%"></p>
<p>It will always output the original DataFrame <strong>and</strong> the outputs of your expressions.</p>
<p>If your expression returns just a single value (e.g.&nbsp;the mean of a column), Polars is smart enough to automatically repeat that value over all rows to make sure it fits inside the DataFrame.</p>
<div id="e0fdc779" class="cell" data-execution_count="41">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start with_columns context</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a>df_1.with_columns(</span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>    acc_mean<span class="op">=</span>col(<span class="st">'accuracy'</span>).mean() <span class="co"># &lt;- expression like before</span></span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="37">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">acc_mean</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
<td>56.066667</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
<td>56.066667</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
<td>56.066667</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
<td>56.066667</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
<td>56.066667</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>70</td>
<td>439.524973</td>
<td>56.066667</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>55.11928</td>
<td>56.066667</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>644.801272</td>
<td>56.066667</td>
</tr>
<tr class="even">
<td>3</td>
<td>12</td>
<td>571.800553</td>
<td>56.066667</td>
</tr>
<tr class="odd">
<td>3</td>
<td>58</td>
<td>715.224208</td>
<td>56.066667</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Contrast this with the <code>.select</code> context which will <em>only</em> return the mean of accuracy:</p>
<div id="d7bfb222" class="cell" data-execution_count="42">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a>df_1.select(</span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>    acc_mean<span class="op">=</span>col(<span class="st">'accuracy'</span>).mean()</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="38">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 1)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">acc_mean</th>
</tr>
<tr class="even">
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>56.066667</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>As before we can create multiple new columns by including <strong>multiple expressions</strong>:</p>
<div id="c4ee2021" class="cell" data-execution_count="43">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>df_1.with_columns(</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a>    acc_mean<span class="op">=</span>col(<span class="st">'accuracy'</span>).mean(),</span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>    rt_scaled<span class="op">=</span>col(<span class="st">'rt'</span>) <span class="op">/</span> <span class="dv">100</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="39">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">acc_mean</th>
<th data-quarto-table-cell-role="th">rt_scaled</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
<td>56.066667</td>
<td>2.612843</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
<td>56.066667</td>
<td>7.282085</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
<td>56.066667</td>
<td>8.01889</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
<td>56.066667</td>
<td>7.13555</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
<td>56.066667</td>
<td>3.626821</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>70</td>
<td>439.524973</td>
<td>56.066667</td>
<td>4.39525</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>55.11928</td>
<td>56.066667</td>
<td>0.551193</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>644.801272</td>
<td>56.066667</td>
<td>6.448013</td>
</tr>
<tr class="even">
<td>3</td>
<td>12</td>
<td>571.800553</td>
<td>56.066667</td>
<td>5.718006</td>
</tr>
<tr class="odd">
<td>3</td>
<td>58</td>
<td>715.224208</td>
<td>56.066667</td>
<td>7.152242</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Using .over() to perform Tidy group-by operations">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Using .over() to perform Tidy group-by operations
</div>
</div>
<div class="callout-body-container callout-body">
<p>A very handy use for <code>.with_columns</code> is to combine it with the <a href="https://docs.pola.rs/api/python/dev/reference/expressions/api/polars.Expr.over.html"><code>.over()</code> operation</a>.</p>
<p>This allows us to calculate an expression <strong>separately by group</strong>, but then save the results into a DataFrame the <em>same size</em> as the original.</p>
<p>For example, Polars will keep the tidy-format of the data and correctly repeat the values across rows.</p>
</div>
</div>
<div id="6a267082" class="cell" data-execution_count="44">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a>df_1.with_columns(</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>    acc_mean<span class="op">=</span>col(<span class="st">'accuracy'</span>).mean().over(<span class="st">'participant'</span>) <span class="co"># &lt;- chaining .over() handles grouping!</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="40">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">acc_mean</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
<td>57.8</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
<td>57.8</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
<td>57.8</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
<td>57.8</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
<td>57.8</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>70</td>
<td>439.524973</td>
<td>63.2</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>55.11928</td>
<td>63.2</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>644.801272</td>
<td>63.2</td>
</tr>
<tr class="even">
<td>3</td>
<td>12</td>
<td>571.800553</td>
<td>63.2</td>
</tr>
<tr class="odd">
<td>3</td>
<td>58</td>
<td>715.224208</td>
<td>63.2</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Chaining <code>.over('some_col')</code> to any expression is like using <code>.group_by</code> but <strong>preserving the shape</strong> of the original DataFrame:</p>
<div id="1cdf6d03" class="cell" data-execution_count="45">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>df_1.with_columns(</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a>    acc_mean<span class="op">=</span>col(<span class="st">'accuracy'</span>).mean().over(<span class="st">'participant'</span>),</span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>    rt_mean<span class="op">=</span>col(<span class="st">'rt'</span>).mean().over(<span class="st">'participant'</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="41">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">acc_mean</th>
<th data-quarto-table-cell-role="th">rt_mean</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
<td>57.8</td>
<td>573.523797</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
<td>57.8</td>
<td>573.523797</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
<td>57.8</td>
<td>573.523797</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
<td>57.8</td>
<td>573.523797</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
<td>57.8</td>
<td>573.523797</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>70</td>
<td>439.524973</td>
<td>63.2</td>
<td>485.294057</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>55.11928</td>
<td>63.2</td>
<td>485.294057</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>644.801272</td>
<td>63.2</td>
<td>485.294057</td>
</tr>
<tr class="even">
<td>3</td>
<td>12</td>
<td>571.800553</td>
<td>63.2</td>
<td>485.294057</td>
</tr>
<tr class="odd">
<td>3</td>
<td>58</td>
<td>715.224208</td>
<td>63.2</td>
<td>485.294057</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Remember that the <code>.group_by()</code> <strong>context</strong> will always return a <strong>smaller</strong> aggregated DataFrame:</p>
<div id="ff4ec0e1" class="cell" data-execution_count="46">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>df_1.group_by(<span class="st">'participant'</span>, maintain_order<span class="op">=</span><span class="va">True</span>).agg(</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    acc_mean<span class="op">=</span>col(<span class="st">'accuracy'</span>).mean(),</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>    rt_mean<span class="op">=</span>col(<span class="st">'rt'</span>).mean()</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="42">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">acc_mean</th>
<th data-quarto-table-cell-role="th">rt_mean</th>
</tr>
<tr class="even">
<td>i64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>57.8</td>
<td>573.523797</td>
</tr>
<tr class="even">
<td>2</td>
<td>47.2</td>
<td>496.969382</td>
</tr>
<tr class="odd">
<td>3</td>
<td>63.2</td>
<td>485.294057</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>In Polars you should only rely on <code>.group_by</code> if you know <em>for sure</em> that you want your output to be <strong>smaller</strong> than your original DataFrame - and by smaller we mean rows = number of groups.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create a DataFrame that adds 3 new columns:</p>
<ol type="1">
<li>Accuracy on a 0-1 scale</li>
<li>RT / Accuracy</li>
<li>RT / max RT, separately using each participant’s max RT</li>
</ol>
</div>
</div>
<div id="9fce1fdd" class="cell" data-execution_count="47">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Hint: you can wrap an entire expression in () and use .over()</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a><span class="co"># on the entire wrapped expression to do things like</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="co"># add, subtract columns multiple columns by "participant"</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-16-contents" aria-controls="callout-16" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-16" class="callout-16-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="1a1404d5" class="cell" data-execution_count="48">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>df_1.with_columns(</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>    acc_scaled <span class="op">=</span> col(<span class="st">'accuracy'</span>) <span class="op">/</span> <span class="dv">100</span>,</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a>    rt_acc <span class="op">=</span> col(<span class="st">'rt'</span>) <span class="op">/</span> col(<span class="st">'accuracy'</span>),</span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a>    rt_max_scaled <span class="op">=</span> (col(<span class="st">'rt'</span>) <span class="op">/</span> col(<span class="st">'rt'</span>).<span class="bu">max</span>()).over(<span class="st">'participant'</span>)</span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="43">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">acc_scaled</th>
<th data-quarto-table-cell-role="th">rt_acc</th>
<th data-quarto-table-cell-role="th">rt_max_scaled</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
<td>0.44</td>
<td>5.938281</td>
<td>0.325836</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
<td>0.47</td>
<td>15.493798</td>
<td>0.908116</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
<td>0.64</td>
<td>12.529516</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
<td>0.67</td>
<td>10.650075</td>
<td>0.889843</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
<td>0.67</td>
<td>5.413166</td>
<td>0.452285</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>70</td>
<td>439.524973</td>
<td>0.7</td>
<td>6.278928</td>
<td>0.614528</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>55.11928</td>
<td>0.88</td>
<td>0.626355</td>
<td>0.077066</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>644.801272</td>
<td>0.88</td>
<td>7.327287</td>
<td>0.901537</td>
</tr>
<tr class="even">
<td>3</td>
<td>12</td>
<td>571.800553</td>
<td>0.12</td>
<td>47.650046</td>
<td>0.79947</td>
</tr>
<tr class="odd">
<td>3</td>
<td>58</td>
<td>715.224208</td>
<td>0.58</td>
<td>12.331452</td>
<td>1.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="selecting-rows-.filter" class="level2">
<h2 class="anchored" data-anchor-id="selecting-rows-.filter">Selecting rows: <code>.filter()</code></h2>
<p>The <code>.filter</code> context is used for <strong>sub-setting rows</strong> using a <strong>logical expression</strong>.</p>
<p><img src="figs/03_subset_rows.svg" class="img-fluid" style="width:50.0%"></p>
<p>Instead of returning one or more values like other expressions, a <strong>logical expression</strong> returns True/False values that we can use to filter rows that mean those criteria:</p>
<div id="ed797d6d" class="cell" data-execution_count="49">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># start filter context</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>df_1.<span class="bu">filter</span>(</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'participant'</span>) <span class="op">==</span> <span class="dv">1</span> <span class="co"># &lt;- expression like before</span></span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="44">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Or in Polars methods-style using <code>.eq()</code>:</p>
<div id="c35e5e58" class="cell" data-execution_count="50">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a>df_1.<span class="bu">filter</span>(</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'participant'</span>).eq(<span class="dv">1</span>)</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="45">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Or even the opposite: we can <strong>negate</strong> or <strong>invert</strong> any <strong>logical expression</strong> by putting a <code>~</code> in front of it.</p>
<p>This is like using <code>not</code> in regular Python or <code>!</code> in some other languages.</p>
<div id="b3281ca3" class="cell" data-execution_count="51">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>df_1.<span class="bu">filter</span>(</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">~</span>col(<span class="st">'participant'</span>).eq(<span class="dv">1</span>)</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="46">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>9</td>
<td>502.974663</td>
</tr>
<tr class="even">
<td>2</td>
<td>83</td>
<td>424.866821</td>
</tr>
<tr class="odd">
<td>2</td>
<td>21</td>
<td>492.355273</td>
</tr>
<tr class="even">
<td>2</td>
<td>36</td>
<td>573.594895</td>
</tr>
<tr class="odd">
<td>2</td>
<td>87</td>
<td>491.05526</td>
</tr>
<tr class="even">
<td>3</td>
<td>70</td>
<td>439.524973</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>55.11928</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>644.801272</td>
</tr>
<tr class="odd">
<td>3</td>
<td>12</td>
<td>571.800553</td>
</tr>
<tr class="even">
<td>3</td>
<td>58</td>
<td>715.224208</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-important callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Important
</div>
</div>
<div class="callout-body-container callout-body">
<p>But be careful. If you’re not using the <em>method-chaining</em> style then you need to wrap you expression in <code>()</code> before using <code>~</code>:</p>
</div>
</div>
<div id="b6e287fc" class="cell" data-execution_count="52">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>df_1.<span class="bu">filter</span>(</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>    <span class="op">~</span>(col(<span class="st">'participant'</span>) <span class="op">==</span> <span class="dv">1</span>)   <span class="co"># &lt;- notice extra () around expression</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="47">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>2</td>
<td>9</td>
<td>502.974663</td>
</tr>
<tr class="even">
<td>2</td>
<td>83</td>
<td>424.866821</td>
</tr>
<tr class="odd">
<td>2</td>
<td>21</td>
<td>492.355273</td>
</tr>
<tr class="even">
<td>2</td>
<td>36</td>
<td>573.594895</td>
</tr>
<tr class="odd">
<td>2</td>
<td>87</td>
<td>491.05526</td>
</tr>
<tr class="even">
<td>3</td>
<td>70</td>
<td>439.524973</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>55.11928</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>644.801272</td>
</tr>
<tr class="odd">
<td>3</td>
<td>12</td>
<td>571.800553</td>
</tr>
<tr class="even">
<td>3</td>
<td>58</td>
<td>715.224208</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Just like in with other contexts (i.e.&nbsp;<code>.select</code>, <code>.with_columns</code>, <code>.group_by</code>) we can using <strong>multiple logical expressions</strong> to refine our filtering criteria.</p>
<p>If we use <code>,</code> Polars treats them logically as an <code>and</code> statement. For example, we use 2 logical expressions to filter where: participant is 1 AND accuracy is 67:</p>
<div id="35b4820c" class="cell" data-execution_count="53">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>df_1.<span class="bu">filter</span>(</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'participant'</span>).eq(<span class="dv">1</span>),</span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'accuracy'</span>).eq(<span class="dv">67</span>)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="48">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>713.555026</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>362.682105</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>But you might find it clearer to use <code>&amp;</code> for <strong>and</strong> expressions:</p>
<div id="5d917bc7" class="cell" data-execution_count="54">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>df_1.<span class="bu">filter</span>(</span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'participant'</span>).eq(<span class="dv">1</span>) <span class="op">&amp;</span> col(<span class="st">'accuracy'</span>).eq(<span class="dv">67</span>)</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="49">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>713.555026</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>362.682105</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The <code>|</code> operator can be used for <strong>or</strong> expressions:</p>
<div id="c7e9eecb" class="cell" data-execution_count="55">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>df_1.<span class="bu">filter</span>(</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'participant'</span>).eq(<span class="dv">1</span>) <span class="op">|</span> col(<span class="st">'participant'</span>).eq(<span class="dv">3</span>)</span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="50">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
</tr>
<tr class="even">
<td>3</td>
<td>70</td>
<td>439.524973</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>55.11928</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>644.801272</td>
</tr>
<tr class="odd">
<td>3</td>
<td>12</td>
<td>571.800553</td>
</tr>
<tr class="even">
<td>3</td>
<td>58</td>
<td>715.224208</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>To combine more complicated <strong>logical expressions</strong>, you can wrap them in <code>()</code>.</p>
<p>Below we get rows where participant 1’s accuracy is 67 OR any of participant 2’s rows:</p>
<div id="c3dfd51c" class="cell" data-execution_count="56">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>df_1.<span class="bu">filter</span>(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'participant'</span>).eq(<span class="dv">1</span>) <span class="op">&amp;</span> col(<span class="st">'accuracy'</span>).eq(<span class="dv">67</span>) <span class="op">|</span> col(<span class="st">'participant'</span>).eq(<span class="dv">2</span>)</span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="51">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (7, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>713.555026</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>362.682105</td>
</tr>
<tr class="odd">
<td>2</td>
<td>9</td>
<td>502.974663</td>
</tr>
<tr class="even">
<td>2</td>
<td>83</td>
<td>424.866821</td>
</tr>
<tr class="odd">
<td>2</td>
<td>21</td>
<td>492.355273</td>
</tr>
<tr class="even">
<td>2</td>
<td>36</td>
<td>573.594895</td>
</tr>
<tr class="odd">
<td>2</td>
<td>87</td>
<td>491.05526</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Two styles of logical expressions">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Two styles of logical expressions
</div>
</div>
<div class="callout-body-container callout-body">
<p>Like renaming the outputs of an expression, Polars gives us 2 styles we can use to combine logical expressions.</p>
<p>We’ve seen the first one using <code>&amp;</code> and <code>|</code>.</p>
<p>The second one uses the <em>method-chaining</em> style with the <code>.</code> syntax. Here Polars provides a <code>.and_()</code> and a <code>.or_()</code> method.</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>df_1.<span class="bu">filter</span>(</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'participant'</span>).eq(<span class="dv">1</span>).and_(</span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>        col(<span class="st">'accuracy'</span>).eq(<span class="dv">67</span>)).or_(</span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a>            col(<span class="st">'participant'</span>).eq(<span class="dv">2</span>)</span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Feel free to use which every style you find more intuitive and readable:</p>
</div>
</div>
</section>
<section id="missing-data-null-vs-nan" class="level2">
<h2 class="anchored" data-anchor-id="missing-data-null-vs-nan">Missing Data: <code>null</code> vs <code>NaN</code></h2>
<p>┌─────────┬───────────────────────────┬────────────────────────────────────────┐ │ │ null │ NaN │ ├─────────┼───────────────────────────┼────────────────────────────────────────┤ │ Meaning │ Missing/unknown value │ “Not a Number” (undefined math result) │ ├─────────┼───────────────────────────┼────────────────────────────────────────┤ │ Dtype │ Any column type │ Float columns only │ ├─────────┼───────────────────────────┼────────────────────────────────────────┤ │ Origin │ Empty cells, missing data │ Math like 0/0, ∞ - ∞, sqrt(-1) │ ├─────────┼───────────────────────────┼────────────────────────────────────────┤ │ Check │ .is_null() │ .is_nan() │ ├─────────┼───────────────────────────┼────────────────────────────────────────┤ │ Fill │ .fill_null(val) │ .fill_nan(val) │ └─────────┴───────────────────────────┴────────────────────────────────────────┘</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>  <span class="im">import</span> polars <span class="im">as</span> pl                                                              </span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>                                                                                   </span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a>  df <span class="op">=</span> pl.DataFrame({                                                              </span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a>      <span class="st">"a"</span>: [<span class="fl">1.0</span>, <span class="va">None</span>, <span class="fl">3.0</span>],      <span class="co"># None → null                                    </span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a>      <span class="st">"b"</span>: [<span class="fl">1.0</span>, <span class="bu">float</span>(<span class="st">'nan'</span>), <span class="fl">3.0</span>]  <span class="co"># NaN from Python                             </span></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a>  })                                                                               </span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a>                                                                                   </span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a>  df.select(                                                                       </span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a>      pl.col(<span class="st">"a"</span>).fill_null(<span class="dv">0</span>),   <span class="co"># fills the null                                 </span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a>      pl.col(<span class="st">"b"</span>).fill_nan(<span class="dv">0</span>),    <span class="co"># fills the NaN                                  </span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a>  )                                                                                </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>Common gotcha: CSV empty cells become null, but division by zero creates NaN.<br>
They require different handling:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>                                                                                   </span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>df.with_columns(                                                                 </span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  (pl.col(<span class="st">"x"</span>) <span class="op">/</span> pl.col(<span class="st">"y"</span>))  <span class="co"># might produce NaN if y=0                      </span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a>  .fill_nan(<span class="va">None</span>)              <span class="co"># convert NaN → null for consistency            </span></span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a>  .fill_null(<span class="dv">0</span>)                <span class="co"># then fill all missing                         </span></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>  .alias(<span class="st">"result"</span>)                                                             </span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>)                                                                                </span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</section>
<section id="expressions-are-for-performing-operations" class="level2">
<h2 class="anchored" data-anchor-id="expressions-are-for-performing-operations">Expressions are for performing <em>operations</em></h2>
<p>So far we’ve see how to build up an <strong>expression</strong> that computes some value, e.g.&nbsp;<code>.mean()</code> or performs some logic, e.g.&nbsp;<code>.eq()</code>.</p>
<p>Polars calls these computations <em>operations</em> and include <strong>tons</strong> of them (accessible via <code>.</code> syntax). Some of the notable ones include:</p>
<p><a href="https://docs.pola.rs/api/python/stable/reference/expressions/operators.html#numeric">Arithmetic</a>, e.g.&nbsp;<code>.add</code>, <code>.sub</code>, <code>.mul</code></p>
<p><a href="https://docs.pola.rs/api/python/stable/reference/expressions/boolean.html">Boolean</a>, e.g.&nbsp;<code>.all</code>, <code>.any</code>, <code>.is_null</code>, <code>.is_not_null</code></p>
<p><a href="https://docs.pola.rs/api/python/stable/reference/expressions/aggregation.html">Summary (aggregate) stats</a>, e.g.&nbsp;<code>.mean</code>, <code>.median</code>, <code>.std</code>, <code>.count</code></p>
<p><a href="https://docs.pola.rs/api/python/stable/reference/expressions/operators.html#comparison">Comparison</a>, e.g.&nbsp;<code>.gt</code>, <code>.lt</code>, <code>.gte</code>, <code>.lte</code>, <code>.eq</code>, <code>.ne</code>.</p>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use the linked documentation and contexts you learned about above to complete the following exercises:</p>
</div>
</div>
<p><strong>1. Select the accuracy and RT columns from <code>df_1</code> and multiply them by 10</strong></p>
<div id="1a9529a9" class="cell" data-execution_count="57">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb70"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-20-contents" aria-controls="callout-20" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-20" class="callout-20-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="b1622279" class="cell" data-execution_count="58">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb71"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>df_1.select(col(<span class="st">'accuracy'</span>, <span class="st">'rt'</span>) <span class="op">*</span> <span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="52">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>i64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>440</td>
<td>2612.843496</td>
</tr>
<tr class="even">
<td>470</td>
<td>7282.084892</td>
</tr>
<tr class="odd">
<td>640</td>
<td>8018.890165</td>
</tr>
<tr class="even">
<td>670</td>
<td>7135.550259</td>
</tr>
<tr class="odd">
<td>670</td>
<td>3626.821046</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>700</td>
<td>4395.249735</td>
</tr>
<tr class="even">
<td>880</td>
<td>551.192796</td>
</tr>
<tr class="odd">
<td>880</td>
<td>6448.012718</td>
</tr>
<tr class="even">
<td>120</td>
<td>5718.005529</td>
</tr>
<tr class="odd">
<td>580</td>
<td>7152.242075</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p><strong>2. Add 2 new columns to the DataFrame: <code>rt_acc</code> and <code>acc_max_scaled</code></strong></p>
<p>For <code>rt_acc</code> divide reaction time by accuracy.</p>
<p>For <code>acc_max_scaled</code> divide accuracy by maximum accuracy, separately by participant.</p>
<div id="5cb5a830" class="cell" data-execution_count="59">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb72"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-21-contents" aria-controls="callout-21" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-21" class="callout-21-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="d758aedd" class="cell" data-execution_count="60">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb73"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>df_1.with_columns(</span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>    rt_acc <span class="op">=</span> col(<span class="st">'rt'</span>) <span class="op">/</span> col(<span class="st">'accuracy'</span>),</span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    acc_max_scaled <span class="op">=</span> (col(<span class="st">'accuracy'</span>) <span class="op">/</span> col(<span class="st">'accuracy'</span>).<span class="bu">max</span>()).over(<span class="st">'participant'</span>)</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="53">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">rt_acc</th>
<th data-quarto-table-cell-role="th">acc_max_scaled</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
<td>5.938281</td>
<td>0.656716</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
<td>15.493798</td>
<td>0.701493</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
<td>12.529516</td>
<td>0.955224</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
<td>10.650075</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
<td>5.413166</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>70</td>
<td>439.524973</td>
<td>6.278928</td>
<td>0.795455</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>55.11928</td>
<td>0.626355</td>
<td>1.0</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>644.801272</td>
<td>7.327287</td>
<td>1.0</td>
</tr>
<tr class="even">
<td>3</td>
<td>12</td>
<td>571.800553</td>
<td>47.650046</td>
<td>0.136364</td>
</tr>
<tr class="odd">
<td>3</td>
<td>58</td>
<td>715.224208</td>
<td>12.331452</td>
<td>0.659091</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p><strong>3. Filter rows where reaction time is &gt; 100ms and &lt; 725ms</strong></p>
<div id="ef87018a" class="cell" data-execution_count="61">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb74"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Hint: You should write a logical expression</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-22-contents" aria-controls="callout-22" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-22" class="callout-22-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="f1091545" class="cell" data-execution_count="62">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb75"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>df_1.<span class="bu">filter</span>(</span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>    (col(<span class="st">'rt'</span>) <span class="op">&gt;</span> <span class="dv">100</span>) <span class="op">&amp;</span> (col(<span class="st">'rt'</span>) <span class="op">&lt;</span> <span class="dv">725</span>)</span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="54">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (12, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
</tr>
<tr class="even">
<td>2</td>
<td>9</td>
<td>502.974663</td>
</tr>
<tr class="odd">
<td>2</td>
<td>83</td>
<td>424.866821</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2</td>
<td>87</td>
<td>491.05526</td>
</tr>
<tr class="even">
<td>3</td>
<td>70</td>
<td>439.524973</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>644.801272</td>
</tr>
<tr class="even">
<td>3</td>
<td>12</td>
<td>571.800553</td>
</tr>
<tr class="odd">
<td>3</td>
<td>58</td>
<td>715.224208</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="saving-re-usable-expressions" class="level2">
<h2 class="anchored" data-anchor-id="saving-re-usable-expressions">Saving re-usable expressions</h2>
<p>When you find yourself creating complex <strong>expressions</strong> that you want to re-use later on, perhaps across other DataFrames, you can save them as re-usable functions!</p>
<p>For example, Polars doesn’t include an operation to calculate a z-score by default. But we know how to do that manually. So let’s create a function called <code>scale</code> that defines an <strong>expression</strong> we can reuse.</p>
<div id="1da9396d" class="cell" data-execution_count="63">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb76"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scale(column_name):</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""Reminder:</span></span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co">        z-score = (x - x.mean() / x.std())</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> (col(column_name) <span class="op">-</span> col(column_name).mean()) <span class="op">/</span> col(column_name).std()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p>This is a function that accepts a single argument <code>column_name</code>, and then uses the <code>col</code> <em>selector</em> from Polars to select a column and calculate its z-score.</p>
<p>We can now use this <strong>expression</strong> in any <strong>context</strong> saves us a ton of typing and typos!</p>
<p>For example just across all accuracy scores:</p>
<div id="0cf5af7f" class="cell" data-execution_count="64">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb77"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a>df_1.select(</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a>    acc_z<span class="op">=</span>scale(<span class="st">'accuracy'</span>)</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="56">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 1)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">acc_z</th>
</tr>
<tr class="even">
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>-0.446194</td>
</tr>
<tr class="even">
<td>-0.335262</td>
</tr>
<tr class="odd">
<td>0.293354</td>
</tr>
<tr class="even">
<td>0.404287</td>
</tr>
<tr class="odd">
<td>0.404287</td>
</tr>
<tr class="even">
<td>…</td>
</tr>
<tr class="odd">
<td>0.515219</td>
</tr>
<tr class="even">
<td>1.180812</td>
</tr>
<tr class="odd">
<td>1.180812</td>
</tr>
<tr class="even">
<td>-1.629472</td>
</tr>
<tr class="odd">
<td>0.07149</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Or as a more realistic example: z-score separately by participant</p>
<p>This is a great example of where <code>.with_columns</code> + <code>.over()</code> can come in super-handy.</p>
<p>Because our function returns an <strong>expression</strong> we can call operations on it just like any other expression:</p>
<div id="c01e26b2" class="cell" data-execution_count="65">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb78"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># .over() works with our scale() function</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="co"># because it return a Polars expression!</span></span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a>df_1.with_columns(</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a>    acc_z<span class="op">=</span>scale(<span class="st">'accuracy'</span>).over(<span class="st">'participant'</span>),</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a>    rt_z<span class="op">=</span>scale(<span class="st">'rt'</span>).over(<span class="st">'participant'</span>)</span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="57">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">acc_z</th>
<th data-quarto-table-cell-role="th">rt_z</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
<td>-1.216438</td>
<td>-1.281041</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
<td>-0.951995</td>
<td>0.634633</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
<td>0.546515</td>
<td>0.936926</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
<td>0.810958</td>
<td>0.574513</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
<td>0.810958</td>
<td>-0.865031</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>70</td>
<td>439.524973</td>
<td>0.217085</td>
<td>-0.175214</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>55.11928</td>
<td>0.791722</td>
<td>-1.646805</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>644.801272</td>
<td>0.791722</td>
<td>0.610629</td>
</tr>
<tr class="even">
<td>3</td>
<td>12</td>
<td>571.800553</td>
<td>-1.634524</td>
<td>0.331166</td>
</tr>
<tr class="odd">
<td>3</td>
<td>58</td>
<td>715.224208</td>
<td>-0.166006</td>
<td>0.880224</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This is entirely equivalent to the following code, but <em>so</em> much <strong>easier to read</strong> and <em>so</em> much <strong>less potential for errors</strong> when typing:</p>
<div id="e5e0c611" class="cell" data-execution_count="66">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb79"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a>df_1.with_columns(</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a>    acc_z<span class="op">=</span>((col(<span class="st">'accuracy'</span>) <span class="op">-</span> col(<span class="st">'accuracy'</span>).mean()) <span class="op">/</span> col(<span class="st">'accuracy'</span>).std()).over(<span class="st">'participant'</span>), rt_z<span class="op">=</span>((col(<span class="st">'rt'</span>) <span class="op">-</span> col(<span class="st">'rt'</span>).mean()) <span class="op">/</span> col(<span class="st">'rt'</span>).std()).over(<span class="st">'participant'</span>)</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="58">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">acc_z</th>
<th data-quarto-table-cell-role="th">rt_z</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
<td>-1.216438</td>
<td>-1.281041</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
<td>-0.951995</td>
<td>0.634633</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
<td>0.546515</td>
<td>0.936926</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
<td>0.810958</td>
<td>0.574513</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
<td>0.810958</td>
<td>-0.865031</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>70</td>
<td>439.524973</td>
<td>0.217085</td>
<td>-0.175214</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>55.11928</td>
<td>0.791722</td>
<td>-1.646805</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>644.801272</td>
<td>0.791722</td>
<td>0.610629</td>
</tr>
<tr class="even">
<td>3</td>
<td>12</td>
<td>571.800553</td>
<td>-1.634524</td>
<td>0.331166</td>
</tr>
<tr class="odd">
<td>3</td>
<td>58</td>
<td>715.224208</td>
<td>-0.166006</td>
<td>0.880224</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Tip
</div>
</div>
<div class="callout-body-container callout-body">
<p>As you’re thinking about how to manipulate data, think about saving an <strong>expression</strong> you find yourself using a lot as function! In fact Python as a short-hand alternative to <code>def</code> for creating simple one-line functions: <code>lambda</code></p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb80"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>myfunc <span class="op">=</span> <span class="kw">lambda</span> param1: <span class="bu">print</span>(param1)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>We can rewrite the function above as a <code>lambda</code> expression like this:</p>
<div class="code-copy-outer-scaffold"><div class="sourceCode" id="cb81"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>scale <span class="op">=</span> <span class="kw">lambda</span> column_name: (col(column_name) <span class="op">-</span> col(column_name).mean()) <span class="op">/</span> col(column_name).std()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
<p>You’ll often see this in Python code when people are defining <em>and</em> using functions within some other code.</p>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<p>Create a Polars expression that mean-centers a column. You can use <code>def</code> or <code>lambda</code> whatever feels more comfortable right now</p>
</div>
</div>
<div id="6b30e30c" class="cell" data-execution_count="67">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb82"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-25-contents" aria-controls="callout-25" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-25" class="callout-25-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="0484c6da" class="cell" data-execution_count="68">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb83"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb83-1"><a href="#cb83-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> mean_center(column_name):</span>
<span id="cb83-2"><a href="#cb83-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> col(column_name) <span class="op">-</span> col(column_name).mean()</span>
<span id="cb83-3"><a href="#cb83-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb83-4"><a href="#cb83-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Or with lambda:</span></span>
<span id="cb83-5"><a href="#cb83-5" aria-hidden="true" tabindex="-1"></a><span class="co"># mean_center = lambda column_name: col(column_name) - col(column_name).mean()</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
</div>
</div>
</div>
<p><strong>Add 2 new columns to the <code>df_1</code> DataFrame that include mean-centered accuracy, and mean-centered RT</strong></p>
<div id="3dcc1e6d" class="cell" data-execution_count="69">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb84"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-26-contents" aria-controls="callout-26" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-26" class="callout-26-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="1ae8adf9" class="cell" data-execution_count="70">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb85"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>df_1.with_columns(</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a>    acc_centered <span class="op">=</span> mean_center(<span class="st">'accuracy'</span>),</span>
<span id="cb85-3"><a href="#cb85-3" aria-hidden="true" tabindex="-1"></a>    rt_centered <span class="op">=</span> mean_center(<span class="st">'rt'</span>)</span>
<span id="cb85-4"><a href="#cb85-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="60">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">acc_centered</th>
<th data-quarto-table-cell-role="th">rt_centered</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
<td>-12.066667</td>
<td>-257.311396</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
<td>-9.066667</td>
<td>209.612744</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
<td>7.933333</td>
<td>283.293271</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
<td>10.933333</td>
<td>194.95928</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
<td>10.933333</td>
<td>-155.913641</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>70</td>
<td>439.524973</td>
<td>13.933333</td>
<td>-79.070772</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>55.11928</td>
<td>31.933333</td>
<td>-463.476466</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>644.801272</td>
<td>31.933333</td>
<td>126.205526</td>
</tr>
<tr class="even">
<td>3</td>
<td>12</td>
<td>571.800553</td>
<td>-44.066667</td>
<td>53.204807</td>
</tr>
<tr class="odd">
<td>3</td>
<td>58</td>
<td>715.224208</td>
<td>1.933333</td>
<td>196.628462</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="more-complex-expression-with-functions-when-and-lit" class="level2">
<h2 class="anchored" data-anchor-id="more-complex-expression-with-functions-when-and-lit">More complex expression with <em>functions</em>: <code>when</code> and <code>lit</code></h2>
<p>Polars also offers a few other <em>operations</em> as <a href="https://docs.pola.rs/api/python/stable/reference/expressions/functions.html">functions</a> you can use inside of a <strong>context</strong> for building <strong>expressions</strong>.</p>
<p>These are called as <code>pl.something()</code> but we can also <strong>directly import</strong> them.</p>
<p>You should check out the documentation to see what’s possible, but two common ones you’re likely to use are <code>pl.when</code> and <code>pl.lit</code></p>
<div id="27124f08" class="cell" data-execution_count="71">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb86"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Directly import them to make life easier</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> polars <span class="im">import</span> when, lit</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<p><code>when</code> lets you run an if-else statement as an expression, which is particularly useful for creating <em>new columns</em> based on the values in another column.</p>
<p><code>lit</code> works in conjunction with <code>when</code> to tell Polars to use the <em>literal</em> value of something rather than try to find a corresponding column name:</p>
<p>Let’s use them together to create a new column that splits participant responses that were faster and slower than 300ms:</p>
<p>We’ll use the <code>.with_columns</code> context, because we want the result of our expression (the new column) <strong>and</strong> the original DataFrame:</p>
<div id="0f03aeb6" class="cell" data-execution_count="72">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb87"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create a new column rt_split that contains the result of the following if/else statement:</span></span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a><span class="co"># If RT &gt;= 300, set the value to the lit(eral) string 'slow'</span></span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Otherwise, set the value to the lit(eral) string 'fast'</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Start with_columns context</span></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>ddf <span class="op">=</span> df_1.with_columns(</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a>    rt_split<span class="op">=</span>when(</span>
<span id="cb87-8"><a href="#cb87-8" aria-hidden="true" tabindex="-1"></a>            col(<span class="st">'rt'</span>) <span class="op">&gt;=</span> <span class="dv">300</span>).then(lit(<span class="st">'slow'</span>)).otherwise(lit(<span class="st">'fast'</span>) <span class="co"># expression inside function</span></span>
<span id="cb87-9"><a href="#cb87-9" aria-hidden="true" tabindex="-1"></a>        )</span>
<span id="cb87-10"><a href="#cb87-10" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb87-11"><a href="#cb87-11" aria-hidden="true" tabindex="-1"></a><span class="co"># We saved the output to a new variable called ddf</span></span>
<span id="cb87-12"><a href="#cb87-12" aria-hidden="true" tabindex="-1"></a>ddf</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="62">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">rt_split</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
<td>"fast"</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
<td>"slow"</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
<td>"slow"</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
<td>"slow"</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
<td>"slow"</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>70</td>
<td>439.524973</td>
<td>"slow"</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>55.11928</td>
<td>"fast"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>644.801272</td>
<td>"slow"</td>
</tr>
<tr class="even">
<td>3</td>
<td>12</td>
<td>571.800553</td>
<td>"slow"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>58</td>
<td>715.224208</td>
<td>"slow"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<p>Use <code>when</code> and <code>lit</code> to add a column to the DataFrame called <code>performance</code>.</p>
<p>It should contain the string ‘success’ if accuracy &gt;= 50, or ‘fail’ if it was &lt; 50.</p>
<p>Save the result to a new dataframe called <code>df_new</code> and print the first 10 rows:</p>
</div>
</div>
<div id="e271bc7d" class="cell" data-execution_count="73">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb88"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-28-contents" aria-controls="callout-28" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-28" class="callout-28-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="20afc4ae" class="cell" data-execution_count="74">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb89"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>df_new <span class="op">=</span> df_1.with_columns(</span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>    performance <span class="op">=</span> when(col(<span class="st">'accuracy'</span>) <span class="op">&gt;=</span> <span class="dv">50</span>).then(lit(<span class="st">'success'</span>)).otherwise(lit(<span class="st">'fail'</span>))</span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a>df_new.head(<span class="dv">10</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="63">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (10, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">performance</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
<td>"fail"</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
<td>"fail"</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
<td>"success"</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
<td>"success"</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
<td>"success"</td>
</tr>
<tr class="even">
<td>2</td>
<td>9</td>
<td>502.974663</td>
<td>"fail"</td>
</tr>
<tr class="odd">
<td>2</td>
<td>83</td>
<td>424.866821</td>
<td>"success"</td>
</tr>
<tr class="even">
<td>2</td>
<td>21</td>
<td>492.355273</td>
<td>"fail"</td>
</tr>
<tr class="odd">
<td>2</td>
<td>36</td>
<td>573.594895</td>
<td>"fail"</td>
</tr>
<tr class="even">
<td>2</td>
<td>87</td>
<td>491.05526</td>
<td>"success"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<p>Using the previous DataFrame (<code>df_new</code>), <em>summarize</em> how many successes and failures each participant had.</p>
<p>Your result should have 6 rows: 2 for each participant</p>
</div>
</div>
<div id="d8224f4a" class="cell" data-execution_count="75">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb90"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Hint: you can group_by multiple columns by passing a list of column names, e.g.</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co"># df_new.group_by(['col_1', 'col_2']).agg(...)</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-30-contents" aria-controls="callout-30" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-30" class="callout-30-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="817b122a" class="cell" data-execution_count="76">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb91"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb91-1"><a href="#cb91-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First create df_new if it wasn't created above</span></span>
<span id="cb91-2"><a href="#cb91-2" aria-hidden="true" tabindex="-1"></a>df_new <span class="op">=</span> df_1.with_columns(</span>
<span id="cb91-3"><a href="#cb91-3" aria-hidden="true" tabindex="-1"></a>    performance <span class="op">=</span> when(col(<span class="st">'accuracy'</span>) <span class="op">&gt;=</span> <span class="dv">50</span>).then(lit(<span class="st">'success'</span>)).otherwise(lit(<span class="st">'fail'</span>))</span>
<span id="cb91-4"><a href="#cb91-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb91-5"><a href="#cb91-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb91-6"><a href="#cb91-6" aria-hidden="true" tabindex="-1"></a>df_new.group_by([<span class="st">'participant'</span>, <span class="st">'performance'</span>], maintain_order<span class="op">=</span><span class="va">True</span>).agg(</span>
<span id="cb91-7"><a href="#cb91-7" aria-hidden="true" tabindex="-1"></a>    count <span class="op">=</span> col(<span class="st">'accuracy'</span>).count()</span>
<span id="cb91-8"><a href="#cb91-8" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="64">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">performance</th>
<th data-quarto-table-cell-role="th">count</th>
</tr>
<tr class="even">
<td>i64</td>
<td>str</td>
<td>u32</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>"fail"</td>
<td>2</td>
</tr>
<tr class="even">
<td>1</td>
<td>"success"</td>
<td>3</td>
</tr>
<tr class="odd">
<td>2</td>
<td>"fail"</td>
<td>3</td>
</tr>
<tr class="even">
<td>2</td>
<td>"success"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>3</td>
<td>"success"</td>
<td>4</td>
</tr>
<tr class="even">
<td>3</td>
<td>"fail"</td>
<td>1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
</section>
<section id="more-complex-expressions-with-attribute-type-operations" class="level2">
<h2 class="anchored" data-anchor-id="more-complex-expressions-with-attribute-type-operations">More complex expressions with <em>attribute (type) operations</em></h2>
<p>In addition to importing functions to build more complicated expressions, Polars also allows you to perform specific <em>operations</em> based upon the <strong>type</strong> of data in a column.</p>
<p>You don’t need to import anything to use these. Instead, you can use <code>.</code> syntax to “narrow down” to the type of <strong>data attribute</strong> you want, and then select the operations you would like.</p>
<p>For example, we’ll use the DataFrame we created in the previous section, <code>ddf</code>:</p>
<div id="9da36c40" class="cell" data-execution_count="77">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb92"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>ddf.head()</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="65">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (5, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">rt_split</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
<td>"fast"</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
<td>"slow"</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
<td>"slow"</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
<td>"slow"</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
<td>"slow"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>To create an expression that converts each value in the new “rt_split” column to uppercase.</p>
<p>We can do this by <em>selecting</em> with <code>col()</code> as usual, but then before calling an operation with <code>.</code> like before, we first access the <code>.str</code> <strong>attribute</strong>, and then call operations that specifically operate on strings!</p>
<div id="8ef06e6e" class="cell" data-execution_count="78">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb93"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>ddf.with_columns(</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'rt_split'</span>).<span class="bu">str</span>.to_uppercase() <span class="co"># .uppercase() is only available to str data!</span></span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="66">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">rt_split</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
<td>"FAST"</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
<td>"SLOW"</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
<td>"SLOW"</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
<td>"SLOW"</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
<td>"SLOW"</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>70</td>
<td>439.524973</td>
<td>"SLOW"</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>55.11928</td>
<td>"FAST"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>644.801272</td>
<td>"SLOW"</td>
</tr>
<tr class="even">
<td>3</td>
<td>12</td>
<td>571.800553</td>
<td>"SLOW"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>58</td>
<td>715.224208</td>
<td>"SLOW"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Without <code>.str</code> to “narrow-in” to the string <strong>attribute</strong> Polars will complain about an <code>AttributeError</code>, because only <code>str</code> types have a <code>.to_uppercase()</code> operation!</p>
<div id="9cc0b0cb" class="cell" data-execution_count="79">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb94"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb94-1"><a href="#cb94-1" aria-hidden="true" tabindex="-1"></a>ddf.with_columns(</span>
<span id="cb94-2"><a href="#cb94-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'rt_split'</span>).to_uppercase() <span class="co"># no .str</span></span>
<span id="cb94-3"><a href="#cb94-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-error">
<div class="ansi-escaped-output">
<pre><span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">AttributeError</span>                            Traceback (most recent call last)
<span class="ansi-cyan-fg">Cell</span><span class="ansi-cyan-fg"> </span><span class="ansi-green-fg">In[67]</span><span class="ansi-green-fg">, line 2</span>
<span class="ansi-green-fg">      1</span> ddf.with_columns(
<span class="ansi-green-fg">----&gt; </span><span class="ansi-green-fg">2</span>     <span class="ansi-yellow-bg">col</span><span class="ansi-yellow-bg">(</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-fg ansi-yellow-bg">rt_split</span><span class="ansi-yellow-fg ansi-yellow-bg">'</span><span class="ansi-yellow-bg">)</span><span class="ansi-yellow-bg">.</span><span class="ansi-yellow-bg">to_uppercase</span>() <span style="font-style:italic;color:rgb(95,135,135)"># no .str</span>
<span class="ansi-green-fg">      3</span> )

<span class="ansi-red-fg">AttributeError</span>: 'Expr' object has no attribute 'to_uppercase'</pre>
</div>
</div>
</div>
<p>Polars includes many attribute operations. The most common ones you’ll use are for working with:</p>
<p><strong><a href="https://docs.pola.rs/api/python/stable/reference/expressions/string.html"><code>.str</code></a></strong>: if your data are strings</p>
<p><strong><a href="https://docs.pola.rs/api/python/stable/reference/expressions/name.html"><code>.name</code></a></strong>: which allows you to quickly change the names of columns from within a more complicated expression.</p>
<p><strong><a href="https://docs.pola.rs/api/python/stable/reference/expressions/list.html"><code>.list</code></a></strong>: if your columns contain Python lists</p>
<p>For example, below we using a <strong>single expression</strong> inside the <code>with_columns</code> context below to calculate the mean of the accuracy and rt columns.</p>
<div id="6b030f0c" class="cell" data-execution_count="80">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb95"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>df_1.with_columns(col(<span class="st">'accuracy'</span>, <span class="st">'rt'</span>).mean())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="68">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>i64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="even">
<td>1</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="odd">
<td>1</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="even">
<td>1</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="odd">
<td>1</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="even">
<td>3</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="odd">
<td>3</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="even">
<td>3</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="odd">
<td>3</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Because we’re using <code>.with_columns</code>, the output of our expression is <strong>overwriting</strong> the original values in the accuracy and rt columns.</p>
<p>We saw how to rename output when we had <strong>separate</strong> <code>col('accuracy').mean()</code> and <code>col('rt').mean()</code> <strong>expressions</strong>: using <code>.alias()</code> at the end or <code>=</code> at the beginning.</p>
<p>But how do we change the names of <em>both</em> columns <strong>at the same time</strong>?</p>
<p>Accessing the <code>.name</code> attribute gives us access to additional <em>operations</em> that help us out. In this case we use the <code>.suffix()</code> operation to add a suffix to the output <code>name</code>(s).</p>
<div id="c4bb4072" class="cell" data-execution_count="81">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb96"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>df_1.with_columns(</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'accuracy'</span>, <span class="st">'rt'</span>).mean().name.suffix(<span class="st">'_mean'</span>)</span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="69">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
<th data-quarto-table-cell-role="th">accuracy_mean</th>
<th data-quarto-table-cell-role="th">rt_mean</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
<td>261.28435</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
<td>728.208489</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
<td>801.889016</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
<td>713.555026</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
<td>362.682105</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>70</td>
<td>439.524973</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
<td>55.11928</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
<td>644.801272</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="even">
<td>3</td>
<td>12</td>
<td>571.800553</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
<tr class="odd">
<td>3</td>
<td>58</td>
<td>715.224208</td>
<td>56.066667</td>
<td>518.595745</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Now we have the <em>original</em> accuracy and rt columns and the newly named ones we created!</p>
</section>
<section id="building-expressions-from-additional-selectors" class="level2">
<h2 class="anchored" data-anchor-id="building-expressions-from-additional-selectors">Building expressions from additional <em>selectors</em></h2>
<p>So far we’ve seen how to use <code>col()</code> to <em>select</em> 1 or more columns we want to create an expression about.</p>
<p>But sometimes you need to <em>select</em> things in more complicated ways. Fortunately, Polars has additional <a href="https://docs.pola.rs/api/python/stable/reference/selectors.html#functions">selectors</a> that we can use to express ourselves. A common pattern is to import these together using <code>as</code>:</p>
<p><code>from polars import selectors as cs</code></p>
<p>Then we can refer to these using <code>cs.some_selector()</code>. Some of these include:</p>
<ul>
<li><code>cs.all()</code></li>
<li><code>cs.exclude()</code></li>
<li><code>cs.starts_with()</code></li>
<li><code>cs.string()</code></li>
</ul>
<p>Let’s see some of these in action using a dataset that include a column of reaction times:</p>
<div id="187f2c5c" class="cell" data-execution_count="82">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb97"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb97-1"><a href="#cb97-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> polars.selectors <span class="im">as</span> cs</span>
<span id="cb97-2"><a href="#cb97-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb97-3"><a href="#cb97-3" aria-hidden="true" tabindex="-1"></a>df_1.select(cs.<span class="bu">all</span>().count())  <span class="co"># &lt;- get all cols and calc count()</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="70">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>u32</td>
<td>u32</td>
<td>u32</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>15</td>
<td>15</td>
<td>15</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>This is as the same as the following code, but many fewer lines!</p>
<div id="bab934bb" class="cell" data-execution_count="83">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb98"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>df_1.select(</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'participant'</span>).count(),</span>
<span id="cb98-3"><a href="#cb98-3" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'accuracy'</span>).count(), col(<span class="st">'rt'</span>).count()</span>
<span id="cb98-4"><a href="#cb98-4" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="71">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>u32</td>
<td>u32</td>
<td>u32</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>15</td>
<td>15</td>
<td>15</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>And <code>cs.exclude</code> is the opposite of <code>cs.all()</code></p>
<div id="bf12340d" class="cell" data-execution_count="84">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb99"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb99-1"><a href="#cb99-1" aria-hidden="true" tabindex="-1"></a>df_1.select(cs.exclude(<span class="st">'participant'</span>).mean())  <span class="co"># &lt;- all cols except participant</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="72">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">accuracy</th>
<th data-quarto-table-cell-role="th">rt</th>
</tr>
<tr class="even">
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>56.066667</td>
<td>518.595745</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can select all columns that start with certain characters:</p>
<div id="b51c2fbe" class="cell" data-execution_count="85">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb100"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>df_1.select(cs.starts_with(<span class="st">'pa'</span>).n_unique())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="73">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (1, 1)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
</tr>
<tr class="even">
<td>u32</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>3</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Or even select columns based on the <em>type</em> of data they contain. In this case all the columns with <em>Integer</em> data:</p>
<div id="ce6e094d" class="cell" data-execution_count="86">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb101"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>df_1.select(cs.integer())</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="74">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (15, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">accuracy</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>44</td>
</tr>
<tr class="even">
<td>1</td>
<td>47</td>
</tr>
<tr class="odd">
<td>1</td>
<td>64</td>
</tr>
<tr class="even">
<td>1</td>
<td>67</td>
</tr>
<tr class="odd">
<td>1</td>
<td>67</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>3</td>
<td>70</td>
</tr>
<tr class="even">
<td>3</td>
<td>88</td>
</tr>
<tr class="odd">
<td>3</td>
<td>88</td>
</tr>
<tr class="even">
<td>3</td>
<td>12</td>
</tr>
<tr class="odd">
<td>3</td>
<td>58</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>There are a many more useful selectors. So check out the <a href="https://docs.pola.rs/api/python/stable/reference/selectors.html#functions">selector documentation page</a> when you’re trying the challenge exercises later on in this notebook</p>
</section>
<section id="reshaping-dataframes" class="level2">
<h2 class="anchored" data-anchor-id="reshaping-dataframes">Reshaping DataFrames</h2>
<p>Sometimes you’ll find yourself working “non-tidy” DataFrames or “wide” format data.</p>
<p>What’s tidy-data again?</p>
<ol type="1">
<li>Each variable must have its own column.</li>
<li>Each observation must have its own row.</li>
<li>Each value must have its own cell.</li>
</ol>
<p>In polars we can achieve this using:</p>
<p><code>.pivot()</code>: long -&gt; wide, similar to <code>pivot_wider()</code> in R <code>.unpivot()</code>: wide -&gt; long, similar to <code>pivot_longer()</code> in R <code>pl.concat()</code>: combine 2 or more DataFrames/columns/rows into a larger DataFrame</p>
<p>Here, I’ve generated data from two participants with three observations. This data frame is not tidy since each row contains more than a <em>single</em> observation.</p>
<div id="8be2fe8d" class="cell" data-execution_count="87">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb102"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a>df_2 <span class="op">=</span> pl.DataFrame(</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>        {<span class="st">'participant'</span>: [<span class="dv">1</span>, <span class="dv">2</span>],</span>
<span id="cb102-3"><a href="#cb102-3" aria-hidden="true" tabindex="-1"></a>        <span class="st">'observation_1'</span>: [<span class="dv">10</span>, <span class="dv">25</span>],</span>
<span id="cb102-4"><a href="#cb102-4" aria-hidden="true" tabindex="-1"></a>        <span class="st">'observation_2'</span>: [<span class="dv">100</span>, <span class="dv">63</span>],</span>
<span id="cb102-5"><a href="#cb102-5" aria-hidden="true" tabindex="-1"></a>        <span class="st">'observation_3'</span>: [<span class="dv">24</span>, <span class="dv">45</span>]</span>
<span id="cb102-6"><a href="#cb102-6" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb102-7"><a href="#cb102-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb102-8"><a href="#cb102-8" aria-hidden="true" tabindex="-1"></a>df_2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="75">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">observation_1</th>
<th data-quarto-table-cell-role="th">observation_2</th>
<th data-quarto-table-cell-role="th">observation_3</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>i64</td>
<td>i64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>10</td>
<td>100</td>
<td>24</td>
</tr>
<tr class="even">
<td>2</td>
<td>25</td>
<td>63</td>
<td>45</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can make it tidy by using the <code>.unpivot</code> method on the DataFrame, which takes 4 arguments:</p>
<p><code>on</code>: the column(s) that contain values for each row <code>index</code>: the column(s) to use as the identifier across rows <code>variable_name</code>: name of the column that contains the original column names <code>value_name</code>: name of the column that contains the values that were previous spread across columns</p>
<div id="168aff38" class="cell" data-execution_count="88">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb103"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Just breaking up over lines to keep it readable!</span></span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>df_long <span class="op">=</span> df_2.unpivot(</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span>cs.starts_with(<span class="st">'observation'</span>),</span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'participant'</span>,</span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>    variable_name<span class="op">=</span><span class="st">'trial'</span>,</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a>    value_name<span class="op">=</span><span class="st">'rating'</span></span>
<span id="cb103-7"><a href="#cb103-7" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb103-8"><a href="#cb103-8" aria-hidden="true" tabindex="-1"></a>df_long</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="76">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">trial</th>
<th data-quarto-table-cell-role="th">rating</th>
</tr>
<tr class="even">
<td>i64</td>
<td>str</td>
<td>i64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>"observation_1"</td>
<td>10</td>
</tr>
<tr class="even">
<td>2</td>
<td>"observation_1"</td>
<td>25</td>
</tr>
<tr class="odd">
<td>1</td>
<td>"observation_2"</td>
<td>100</td>
</tr>
<tr class="even">
<td>2</td>
<td>"observation_2"</td>
<td>63</td>
</tr>
<tr class="odd">
<td>1</td>
<td>"observation_3"</td>
<td>24</td>
</tr>
<tr class="even">
<td>2</td>
<td>"observation_3"</td>
<td>45</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>The <code>.pivot</code> method is the counter-part of <code>.unpivot</code>. We can use it to turn tidydata (long) to wide format. It takes 4 arguments as well:</p>
<p><code>on</code>: the column(s) whose values will be turned into new columns <code>index</code>: the column(s) that are unique rows in the new DataFrame <code>values</code>: the values that will be moved into new columns with each row <code>aggregate_function</code>: how to aggregate multiple rows within each index, e.g.&nbsp;None, mean, first, sum, etc</p>
<div id="bb8bc005" class="cell" data-execution_count="89">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb104"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a>df_long.pivot(</span>
<span id="cb104-2"><a href="#cb104-2" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">'trial'</span>,</span>
<span id="cb104-3"><a href="#cb104-3" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'participant'</span>,</span>
<span id="cb104-4"><a href="#cb104-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">'rating'</span>,</span>
<span id="cb104-5"><a href="#cb104-5" aria-hidden="true" tabindex="-1"></a>    aggregate_function<span class="op">=</span><span class="va">None</span></span>
<span id="cb104-6"><a href="#cb104-6" aria-hidden="true" tabindex="-1"></a>    )</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="77">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">observation_1</th>
<th data-quarto-table-cell-role="th">observation_2</th>
<th data-quarto-table-cell-role="th">observation_3</th>
</tr>
<tr class="even">
<td>i64</td>
<td>i64</td>
<td>i64</td>
<td>i64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>10</td>
<td>100</td>
<td>24</td>
</tr>
<tr class="even">
<td>2</td>
<td>25</td>
<td>63</td>
<td>45</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>You can safely set <code>aggregate_function = None</code> if you don’t have repeated observations within each unique combination of <code>index</code> and <code>on</code>. In this case each participant only has a single “observation_1”, “observation_2”, and “observation_3”.</p>
<p>But if they had multiple, Polars will raise an error and ask you to specify how to aggregate them</p>
</section>
<section id="splitting-1-column-into-many" class="level2">
<h2 class="anchored" data-anchor-id="splitting-1-column-into-many">Splitting 1 column into many</h2>
<p>Sometimes you’ll need to split one column into multiple columns. Let’s say we wanted to split the “year_month” column into 2 separate columns of “year” and “month”:</p>
<div id="082a7bce" class="cell" data-execution_count="90">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb105"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a>df_3 <span class="op">=</span> pl.DataFrame({<span class="st">'id'</span>: [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>], <span class="st">'year_month'</span>: [<span class="st">'2021-01'</span>, <span class="st">'2021-02'</span>, <span class="st">'2021-03'</span>]})</span>
<span id="cb105-2"><a href="#cb105-2" aria-hidden="true" tabindex="-1"></a>df_3</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="78">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">year_month</th>
</tr>
<tr class="even">
<td>i64</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>"2021-01"</td>
</tr>
<tr class="even">
<td>2</td>
<td>"2021-02"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>"2021-03"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>You can use <em><a href="https://docs.pola.rs/api/python/stable/reference/expressions/string.html">attribute operations for <code>.str</code></a></em> to do this!</p>
<p>Specifically we use can <code>.split_exact</code> to split a <code>str</code> into a <code>n+1</code> parts.</p>
<div id="eac0ec87" class="cell" data-execution_count="91">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb106"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a>df_split <span class="op">=</span> df_3.with_columns(</span>
<span id="cb106-2"><a href="#cb106-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'year_month'</span>).<span class="bu">str</span>.split_exact(<span class="st">'-'</span>, <span class="dv">1</span>)</span>
<span id="cb106-3"><a href="#cb106-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb106-4"><a href="#cb106-4" aria-hidden="true" tabindex="-1"></a>df_split  <span class="co"># string attribute method, to split by delimiter "-" into 2 parts</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="79">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">year_month</th>
</tr>
<tr class="even">
<td>i64</td>
<td>struct[2]</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>{"2021","01"}</td>
</tr>
<tr class="even">
<td>2</td>
<td>{"2021","02"}</td>
</tr>
<tr class="odd">
<td>3</td>
<td>{"2021","03"}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Polars stores these parts in a <strong>struct</strong> which is just a Python dictionary:</p>
<div id="076f1d5e" class="cell" data-execution_count="92">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb107"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First row, second column value</span></span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>df_split[<span class="dv">0</span>, <span class="dv">1</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="80">
<pre><code>{'field_0': '2021', 'field_1': '01'}</code></pre>
</div>
</div>
<p>Polars provides additional <em><a href="https://docs.pola.rs/api/python/stable/reference/expressions/struct.html">attribute operations on the <code>.struct</code></a></em> to create new columns.</p>
<p>First we’ll call <code>.rename_fields</code> to rename the <em>fields</em> of the struct (equivalent to renaming the <em>keys</em> of a Python dictionary).</p>
<div id="2be856d2" class="cell" data-execution_count="93">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb109"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a><span class="co"># string attribute method, to split by delimiter "-" into 2 parts</span></span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="co"># struct attribute method to rename fields</span></span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a>df_split_1 <span class="op">=</span> df_3.with_columns(</span>
<span id="cb109-4"><a href="#cb109-4" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'year_month'</span>).<span class="bu">str</span>.split_exact(<span class="st">'-'</span>, <span class="dv">1</span>).struct.rename_fields([<span class="st">'year'</span>, <span class="st">'month'</span>])</span>
<span id="cb109-5"><a href="#cb109-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb109-6"><a href="#cb109-6" aria-hidden="true" tabindex="-1"></a>df_split_1</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="81">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">year_month</th>
</tr>
<tr class="even">
<td>i64</td>
<td>struct[2]</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>{"2021","01"}</td>
</tr>
<tr class="even">
<td>2</td>
<td>{"2021","02"}</td>
</tr>
<tr class="odd">
<td>3</td>
<td>{"2021","03"}</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="ffa17c9e" class="cell" data-execution_count="94">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb110"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="co"># First row, second column value</span></span>
<span id="cb110-2"><a href="#cb110-2" aria-hidden="true" tabindex="-1"></a>df_split_1[<span class="dv">0</span>, <span class="dv">1</span>]</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="82">
<pre><code>{'year': '2021', 'month': '01'}</code></pre>
</div>
</div>
<p>Then we’ll call <code>struct.unnest()</code> to create new columns, 1 per field</p>
<div id="dd7402a4" class="cell" data-execution_count="95">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb112"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># string attribute method, to split by delimiter "-" into 2 parts</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a><span class="co"># struct attribute method to rename fields  # struct attribute method to create 1 column per field</span></span>
<span id="cb112-3"><a href="#cb112-3" aria-hidden="true" tabindex="-1"></a>df_split_2 <span class="op">=</span> df_3.with_columns(</span>
<span id="cb112-4"><a href="#cb112-4" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'year_month'</span>).<span class="bu">str</span>.split_exact(<span class="st">'-'</span>, <span class="dv">1</span>).struct.rename_fields([<span class="st">'year'</span>, <span class="st">'month'</span>]).struct.unnest()</span>
<span id="cb112-5"><a href="#cb112-5" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb112-6"><a href="#cb112-6" aria-hidden="true" tabindex="-1"></a>df_split_2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="83">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">year_month</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
</tr>
<tr class="even">
<td>i64</td>
<td>str</td>
<td>str</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>"2021-01"</td>
<td>"2021"</td>
<td>"01"</td>
</tr>
<tr class="even">
<td>2</td>
<td>"2021-02"</td>
<td>"2021"</td>
<td>"02"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>"2021-03"</td>
<td>"2021"</td>
<td>"03"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>We can also split up values in a column <em>over rows</em> <a href="https://docs.pola.rs/api/python/stable/reference/dataframe/api/polars.DataFrame.explode.html#polars.DataFrame.explode"><code>.explode('column_name')</code> method</a> on the DataFrame itself:</p>
<div id="f32fdff6" class="cell" data-execution_count="96">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb113"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a>df_4 <span class="op">=</span> pl.DataFrame({<span class="st">'letters'</span>: [<span class="st">'a'</span>, <span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>], <span class="st">'numbers'</span>: [[<span class="dv">1</span>], [<span class="dv">2</span>, <span class="dv">3</span>], [<span class="dv">4</span>, <span class="dv">5</span>], [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>]]})</span>
<span id="cb113-2"><a href="#cb113-2" aria-hidden="true" tabindex="-1"></a>df_4</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="84">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">letters</th>
<th data-quarto-table-cell-role="th">numbers</th>
</tr>
<tr class="even">
<td>str</td>
<td>list[i64]</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"a"</td>
<td>[1]</td>
</tr>
<tr class="even">
<td>"a"</td>
<td>[2, 3]</td>
</tr>
<tr class="odd">
<td>"b"</td>
<td>[4, 5]</td>
</tr>
<tr class="even">
<td>"c"</td>
<td>[6, 7, 8]</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div id="f70ee431" class="cell" data-execution_count="97">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb114"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>df_4.explode(<span class="st">'numbers'</span>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="85">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (8, 2)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">letters</th>
<th data-quarto-table-cell-role="th">numbers</th>
</tr>
<tr class="even">
<td>str</td>
<td>i64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"a"</td>
<td>1</td>
</tr>
<tr class="even">
<td>"a"</td>
<td>2</td>
</tr>
<tr class="odd">
<td>"a"</td>
<td>3</td>
</tr>
<tr class="even">
<td>"b"</td>
<td>4</td>
</tr>
<tr class="odd">
<td>"b"</td>
<td>5</td>
</tr>
<tr class="even">
<td>"c"</td>
<td>6</td>
</tr>
<tr class="odd">
<td>"c"</td>
<td>7</td>
</tr>
<tr class="even">
<td>"c"</td>
<td>8</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="combining-many-columns-into-1" class="level2">
<h2 class="anchored" data-anchor-id="combining-many-columns-into-1">Combining many columns into 1</h2>
<p>We can combine columns into a single column using additional <em><a href="https://docs.pola.rs/api/python/stable/reference/expressions/functions.html">functions</a></em> in an expression like <code>pl.concat_list()</code> and <code>pl.concat_str()</code>, which take column names as input:</p>
<div id="39ef885e" class="cell" data-execution_count="98">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb115"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>df_split_2.with_columns(</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>    month_year<span class="op">=</span>pl.concat_str(<span class="st">'month'</span>, <span class="st">'year'</span>, separator<span class="op">=</span><span class="st">'-'</span>)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="86">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (3, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">id</th>
<th data-quarto-table-cell-role="th">year_month</th>
<th data-quarto-table-cell-role="th">year</th>
<th data-quarto-table-cell-role="th">month</th>
<th data-quarto-table-cell-role="th">month_year</th>
</tr>
<tr class="even">
<td>i64</td>
<td>str</td>
<td>str</td>
<td>str</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>"2021-01"</td>
<td>"2021"</td>
<td>"01"</td>
<td>"01-2021"</td>
</tr>
<tr class="even">
<td>2</td>
<td>"2021-02"</td>
<td>"2021"</td>
<td>"02"</td>
<td>"02-2021"</td>
</tr>
<tr class="odd">
<td>3</td>
<td>"2021-03"</td>
<td>"2021"</td>
<td>"03"</td>
<td>"03-2021"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>Polars also includes various <em><a href="https://docs.pola.rs/api/python/stable/reference/expressions/functions.html">functions that end with <code>_horizontal</code></a></em>.</p>
<p>Like the suffix implies, these functions are design to operate <em>horizontally</em> across columns within each row separately.</p>
<p>Let’s say our DataFrame had these 3 numeric columns:</p>
<div id="e322ecf1" class="cell" data-execution_count="99">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb116"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np  <span class="co"># we haven't met this library yet, just using it to generate data</span></span>
<span id="cb116-2"><a href="#cb116-2" aria-hidden="true" tabindex="-1"></a>df_5 <span class="op">=</span> df_4.with_columns(</span>
<span id="cb116-3"><a href="#cb116-3" aria-hidden="true" tabindex="-1"></a>    a<span class="op">=</span>np.random.normal(size<span class="op">=</span>df_4.height),</span>
<span id="cb116-4"><a href="#cb116-4" aria-hidden="true" tabindex="-1"></a>    b<span class="op">=</span>np.random.normal(size<span class="op">=</span>df_4.height),</span>
<span id="cb116-5"><a href="#cb116-5" aria-hidden="true" tabindex="-1"></a>    c<span class="op">=</span>np.random.normal(size<span class="op">=</span>df_4.height)</span>
<span id="cb116-6"><a href="#cb116-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb116-7"><a href="#cb116-7" aria-hidden="true" tabindex="-1"></a>df_5</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="87">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">letters</th>
<th data-quarto-table-cell-role="th">numbers</th>
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">c</th>
</tr>
<tr class="even">
<td>str</td>
<td>list[i64]</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"a"</td>
<td>[1]</td>
<td>1.38304</td>
<td>1.517516</td>
<td>-0.485741</td>
</tr>
<tr class="even">
<td>"a"</td>
<td>[2, 3]</td>
<td>1.255348</td>
<td>-1.143134</td>
<td>2.937848</td>
</tr>
<tr class="odd">
<td>"b"</td>
<td>[4, 5]</td>
<td>-1.109448</td>
<td>0.366913</td>
<td>-1.339077</td>
</tr>
<tr class="even">
<td>"c"</td>
<td>[6, 7, 8]</td>
<td>1.188979</td>
<td>1.125729</td>
<td>0.025955</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p>And we want to create a new column that is the average of these 3 columns within each row. We can easily to that using a <em>horizontal function</em> like <code>pl.mean_horizontal</code></p>
<div id="b51f0fbb" class="cell" data-execution_count="100">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb117"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a>df_5.with_columns(abc_mean<span class="op">=</span>pl.mean_horizontal(<span class="st">'a'</span>, <span class="st">'b'</span>, <span class="st">'c'</span>))</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="88">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (4, 6)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">letters</th>
<th data-quarto-table-cell-role="th">numbers</th>
<th data-quarto-table-cell-role="th">a</th>
<th data-quarto-table-cell-role="th">b</th>
<th data-quarto-table-cell-role="th">c</th>
<th data-quarto-table-cell-role="th">abc_mean</th>
</tr>
<tr class="even">
<td>str</td>
<td>list[i64]</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>"a"</td>
<td>[1]</td>
<td>1.38304</td>
<td>1.517516</td>
<td>-0.485741</td>
<td>0.804938</td>
</tr>
<tr class="even">
<td>"a"</td>
<td>[2, 3]</td>
<td>1.255348</td>
<td>-1.143134</td>
<td>2.937848</td>
<td>1.016687</td>
</tr>
<tr class="odd">
<td>"b"</td>
<td>[4, 5]</td>
<td>-1.109448</td>
<td>0.366913</td>
<td>-1.339077</td>
<td>-0.693871</td>
</tr>
<tr class="even">
<td>"c"</td>
<td>[6, 7, 8]</td>
<td>1.188979</td>
<td>1.125729</td>
<td>0.025955</td>
<td>0.780221</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</section>
<section id="your-turn" class="level2">
<h2 class="anchored" data-anchor-id="your-turn">Your Turn</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Your Turn">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Tip</span>Your Turn
</div>
</div>
<div class="callout-body-container callout-body">
<p>Make the following DataFrame “tidy”, i.e.&nbsp;long-format with 4 columns:</p>
<ul>
<li>participant: integer of participant ID</li>
<li>order: integer stimulus and observation order (from column names)</li>
<li>stimulus: string of stimulus name</li>
<li>observation: float of numeric rating each participant gave</li>
</ul>
</div>
</div>
<div id="653b7646" class="cell" data-execution_count="101">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb118"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>reshape <span class="op">=</span> pl.DataFrame({</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>    <span class="st">'participant'</span>: [<span class="fl">1.</span>, <span class="fl">2.</span>],</span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stimulus_1'</span>: [<span class="st">'flower'</span>, <span class="st">'car'</span>],</span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>    <span class="st">'observation_1'</span>: [<span class="fl">10.</span>, <span class="fl">25.</span>,],</span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stimulus_2'</span>: [<span class="st">'house'</span>, <span class="st">'flower'</span>],</span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>    <span class="st">'observation_2'</span>: [<span class="fl">100.</span>, <span class="fl">63.</span>,],</span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>    <span class="st">'stimulus_3'</span>: [<span class="st">'car'</span>, <span class="st">'house'</span>],</span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>    <span class="st">'observation_3'</span>: [<span class="fl">24.</span>, <span class="fl">45.</span>,]</span>
<span id="cb118-9"><a href="#cb118-9" aria-hidden="true" tabindex="-1"></a>})</span>
<span id="cb118-10"><a href="#cb118-10" aria-hidden="true" tabindex="-1"></a>reshape</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="89">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (2, 7)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">stimulus_1</th>
<th data-quarto-table-cell-role="th">observation_1</th>
<th data-quarto-table-cell-role="th">stimulus_2</th>
<th data-quarto-table-cell-role="th">observation_2</th>
<th data-quarto-table-cell-role="th">stimulus_3</th>
<th data-quarto-table-cell-role="th">observation_3</th>
</tr>
<tr class="even">
<td>f64</td>
<td>str</td>
<td>f64</td>
<td>str</td>
<td>f64</td>
<td>str</td>
<td>f64</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
<td>"flower"</td>
<td>10.0</td>
<td>"house"</td>
<td>100.0</td>
<td>"car"</td>
<td>24.0</td>
</tr>
<tr class="even">
<td>2.0</td>
<td>"car"</td>
<td>25.0</td>
<td>"flower"</td>
<td>63.0</td>
<td>"house"</td>
<td>45.0</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<p><strong>Hints</strong></p>
<p>Think about this as a sequence of 4 steps. We’ve created 4 code cells below with an image above each of the expected result:</p>
<p><strong>1. unpivot wide -&gt; long</strong></p>
<p><img src="figs/step1.png" class="img-fluid" style="width:40.0%"></p>
<div id="22f9cb8a" class="cell" data-execution_count="102">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb119"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-32-contents" aria-controls="callout-32" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-32" class="callout-32-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="456427e8" class="cell" data-execution_count="103">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb120"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb120-1"><a href="#cb120-1" aria-hidden="true" tabindex="-1"></a>step1 <span class="op">=</span> reshape.unpivot(</span>
<span id="cb120-2"><a href="#cb120-2" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span>cs.exclude(<span class="st">'participant'</span>),</span>
<span id="cb120-3"><a href="#cb120-3" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span><span class="st">'participant'</span>,</span>
<span id="cb120-4"><a href="#cb120-4" aria-hidden="true" tabindex="-1"></a>    variable_name<span class="op">=</span><span class="st">'trial'</span>,</span>
<span id="cb120-5"><a href="#cb120-5" aria-hidden="true" tabindex="-1"></a>    value_name<span class="op">=</span><span class="st">'rating'</span></span>
<span id="cb120-6"><a href="#cb120-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb120-7"><a href="#cb120-7" aria-hidden="true" tabindex="-1"></a>step1</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="90">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (12, 3)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">trial</th>
<th data-quarto-table-cell-role="th">rating</th>
</tr>
<tr class="even">
<td>f64</td>
<td>str</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
<td>"stimulus_1"</td>
<td>"flower"</td>
</tr>
<tr class="even">
<td>2.0</td>
<td>"stimulus_1"</td>
<td>"car"</td>
</tr>
<tr class="odd">
<td>1.0</td>
<td>"observation_1"</td>
<td>"10.0"</td>
</tr>
<tr class="even">
<td>2.0</td>
<td>"observation_1"</td>
<td>"25.0"</td>
</tr>
<tr class="odd">
<td>1.0</td>
<td>"stimulus_2"</td>
<td>"house"</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>"observation_2"</td>
<td>"63.0"</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>"stimulus_3"</td>
<td>"car"</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>"stimulus_3"</td>
<td>"house"</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>"observation_3"</td>
<td>"24.0"</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>"observation_3"</td>
<td>"45.0"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p><strong>2. split the <code>variable_name</code> column from the previous step (I called it <code>trial</code>) into 2 new columns by <code>_</code> (which I called <code>index</code> and <code>order</code>)</strong></p>
<p><img src="figs/step2.png" class="img-fluid" style="width:60.0%"></p>
<div id="628e1405" class="cell" data-execution_count="104">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb121"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-33-contents" aria-controls="callout-33" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-33" class="callout-33-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="f7cd800d" class="cell" data-execution_count="105">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb122"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>step2 <span class="op">=</span> step1.with_columns(</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>    col(<span class="st">'trial'</span>).<span class="bu">str</span>.split_exact(<span class="st">'_'</span>, <span class="dv">1</span>).struct.rename_fields([<span class="st">'index'</span>, <span class="st">'order'</span>]).struct.unnest()</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb122-4"><a href="#cb122-4" aria-hidden="true" tabindex="-1"></a>step2</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="91">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (12, 5)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">trial</th>
<th data-quarto-table-cell-role="th">rating</th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">order</th>
</tr>
<tr class="even">
<td>f64</td>
<td>str</td>
<td>str</td>
<td>str</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
<td>"stimulus_1"</td>
<td>"flower"</td>
<td>"stimulus"</td>
<td>"1"</td>
</tr>
<tr class="even">
<td>2.0</td>
<td>"stimulus_1"</td>
<td>"car"</td>
<td>"stimulus"</td>
<td>"1"</td>
</tr>
<tr class="odd">
<td>1.0</td>
<td>"observation_1"</td>
<td>"10.0"</td>
<td>"observation"</td>
<td>"1"</td>
</tr>
<tr class="even">
<td>2.0</td>
<td>"observation_1"</td>
<td>"25.0"</td>
<td>"observation"</td>
<td>"1"</td>
</tr>
<tr class="odd">
<td>1.0</td>
<td>"stimulus_2"</td>
<td>"house"</td>
<td>"stimulus"</td>
<td>"2"</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>"observation_2"</td>
<td>"63.0"</td>
<td>"observation"</td>
<td>"2"</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>"stimulus_3"</td>
<td>"car"</td>
<td>"stimulus"</td>
<td>"3"</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>"stimulus_3"</td>
<td>"house"</td>
<td>"stimulus"</td>
<td>"3"</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>"observation_3"</td>
<td>"24.0"</td>
<td>"observation"</td>
<td>"3"</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>"observation_3"</td>
<td>"45.0"</td>
<td>"observation"</td>
<td>"3"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p><strong>3. select only the columns: <code>participant</code>, 2 you created (I called mine <code>index</code> and <code>order</code>), and the <code>value_name</code> column from the first step (I called it <code>rating</code>)</strong></p>
<p><img src="figs/step3.png" class="img-fluid" style="width:40.0%"></p>
<div id="ef650511" class="cell" data-execution_count="106">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb123"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-34-contents" aria-controls="callout-34" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-34" class="callout-34-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="7df94800" class="cell" data-execution_count="107">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb124"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>step3 <span class="op">=</span> step2.select(col(<span class="st">'participant'</span>, <span class="st">'index'</span>, <span class="st">'order'</span>, <span class="st">'rating'</span>))</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a>step3</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="92">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (12, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">index</th>
<th data-quarto-table-cell-role="th">order</th>
<th data-quarto-table-cell-role="th">rating</th>
</tr>
<tr class="even">
<td>f64</td>
<td>str</td>
<td>str</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
<td>"stimulus"</td>
<td>"1"</td>
<td>"flower"</td>
</tr>
<tr class="even">
<td>2.0</td>
<td>"stimulus"</td>
<td>"1"</td>
<td>"car"</td>
</tr>
<tr class="odd">
<td>1.0</td>
<td>"observation"</td>
<td>"1"</td>
<td>"10.0"</td>
</tr>
<tr class="even">
<td>2.0</td>
<td>"observation"</td>
<td>"1"</td>
<td>"25.0"</td>
</tr>
<tr class="odd">
<td>1.0</td>
<td>"stimulus"</td>
<td>"2"</td>
<td>"house"</td>
</tr>
<tr class="even">
<td>…</td>
<td>…</td>
<td>…</td>
<td>…</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>"observation"</td>
<td>"2"</td>
<td>"63.0"</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>"stimulus"</td>
<td>"3"</td>
<td>"car"</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>"stimulus"</td>
<td>"3"</td>
<td>"house"</td>
</tr>
<tr class="even">
<td>1.0</td>
<td>"observation"</td>
<td>"3"</td>
<td>"24.0"</td>
</tr>
<tr class="odd">
<td>2.0</td>
<td>"observation"</td>
<td>"3"</td>
<td>"45.0"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<p><strong>4. pivot long -&gt; wide to break-out the <code>value_name</code> column (I called it <code>rating</code>) into multiple columns</strong></p>
<p><img src="figs/step4.png" class="img-fluid" style="width:40.0%"></p>
<div id="a591c9f9" class="cell" data-execution_count="108">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb125"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb125-1"><a href="#cb125-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Your code here</span></span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Solution">
<div class="callout-header d-flex align-content-center collapsed" data-bs-toggle="collapse" data-bs-target=".callout-35-contents" aria-controls="callout-35" aria-expanded="false" aria-label="Toggle callout">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
<span class="screen-reader-only">Note</span>Solution
</div>
<div class="callout-btn-toggle d-inline-block border-0 py-1 ps-1 pe-0 float-end"><i class="callout-toggle"></i></div>
</div>
<div id="callout-35" class="callout-35-contents callout-collapse collapse">
<div class="callout-body-container callout-body">
<div id="4d987d8f" class="cell" data-execution_count="109">
<details open="" class="code-fold">
<summary>Code</summary>
<div class="code-copy-outer-scaffold"><div class="sourceCode cell-code" id="cb126"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a>step4 <span class="op">=</span> step3.pivot(</span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>    on<span class="op">=</span><span class="st">'index'</span>,</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a>    index<span class="op">=</span>[<span class="st">'participant'</span>, <span class="st">'order'</span>],</span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a>    values<span class="op">=</span><span class="st">'rating'</span>,</span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>    aggregate_function<span class="op">=</span><span class="va">None</span></span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a>step4</span></code></pre></div><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="93">
<div><style>
.dataframe > thead > tr,
.dataframe > tbody > tr {
  text-align: right;
  white-space: pre-wrap;
}
</style>
<small>shape: (6, 4)</small>
<table class="dataframe caption-top table table-sm table-striped small" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th">participant</th>
<th data-quarto-table-cell-role="th">order</th>
<th data-quarto-table-cell-role="th">stimulus</th>
<th data-quarto-table-cell-role="th">observation</th>
</tr>
<tr class="even">
<td>f64</td>
<td>str</td>
<td>str</td>
<td>str</td>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1.0</td>
<td>"1"</td>
<td>"flower"</td>
<td>"10.0"</td>
</tr>
<tr class="even">
<td>2.0</td>
<td>"1"</td>
<td>"car"</td>
<td>"25.0"</td>
</tr>
<tr class="odd">
<td>1.0</td>
<td>"2"</td>
<td>"house"</td>
<td>"100.0"</td>
</tr>
<tr class="even">
<td>2.0</td>
<td>"2"</td>
<td>"flower"</td>
<td>"63.0"</td>
</tr>
<tr class="odd">
<td>1.0</td>
<td>"3"</td>
<td>"car"</td>
<td>"24.0"</td>
</tr>
<tr class="even">
<td>2.0</td>
<td>"3"</td>
<td>"house"</td>
<td>"45.0"</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
</div>
</div>
</div>
<hr>
</section>
<section id="appendix" class="level1">
<h1>Appendix</h1>
<section id="additional-resources" class="level2">
<h2 class="anchored" data-anchor-id="additional-resources">Additional Resources</h2>
<p>Here a few additional resources that might be helpful on your journey:</p>
<ul>
<li><a href="https://docs.pola.rs/user-guide/getting-started/">Polars official intro tutorial</a></li>
<li><a href="https://bebi103a.github.io/lessons/06/intro_to_polars.html#">More Comprehensive intro to Polars</a></li>
<li><a href="https://bebi103a.github.io/lessons/06/tidy_data.html">TidyData analysis in Polars</a></li>
<li><a href="https://www.emilyriederer.com/post/py-rgo-polars/#what-are-dplyrs-ergonomics">Polars patterns vs R’s dplyr</a></li>
</ul>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
  window.document.addEventListener("DOMContentLoaded", function (event) {
    const icon = "";
    const anchorJS = new window.AnchorJS();
    anchorJS.options = {
      placement: 'right',
      icon: icon
    };
    anchorJS.add('.anchored');
    const isCodeAnnotation = (el) => {
      for (const clz of el.classList) {
        if (clz.startsWith('code-annotation-')) {                     
          return true;
        }
      }
      return false;
    }
    const onCopySuccess = function(e) {
      // button target
      const button = e.trigger;
      // don't keep focus
      button.blur();
      // flash "checked"
      button.classList.add('code-copy-button-checked');
      var currentTitle = button.getAttribute("title");
      button.setAttribute("title", "Copied!");
      let tooltip;
      if (window.bootstrap) {
        button.setAttribute("data-bs-toggle", "tooltip");
        button.setAttribute("data-bs-placement", "left");
        button.setAttribute("data-bs-title", "Copied!");
        tooltip = new bootstrap.Tooltip(button, 
          { trigger: "manual", 
            customClass: "code-copy-button-tooltip",
            offset: [0, -8]});
        tooltip.show();    
      }
      setTimeout(function() {
        if (tooltip) {
          tooltip.hide();
          button.removeAttribute("data-bs-title");
          button.removeAttribute("data-bs-toggle");
          button.removeAttribute("data-bs-placement");
        }
        button.setAttribute("title", currentTitle);
        button.classList.remove('code-copy-button-checked');
      }, 1000);
      // clear code selection
      e.clearSelection();
    }
    const getTextToCopy = function(trigger) {
      const outerScaffold = trigger.parentElement.cloneNode(true);
      const codeEl = outerScaffold.querySelector('code');
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
    const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
      text: getTextToCopy
    });
    clipboard.on('success', onCopySuccess);
    if (window.document.getElementById('quarto-embedded-source-code-modal')) {
      const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
        text: getTextToCopy,
        container: window.document.getElementById('quarto-embedded-source-code-modal')
      });
      clipboardModal.on('success', onCopySuccess);
    }
      var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
      var mailtoRegex = new RegExp(/^mailto:/);
        var filterRegex = new RegExp('/' + window.location.host + '/');
      var isInternal = (href) => {
          return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
      }
      // Inspect non-navigation links and adorn them if external
     var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
      for (var i=0; i<links.length; i++) {
        const link = links[i];
        if (!isInternal(link.href)) {
          // undo the damage that might have been done by quarto-nav.js in the case of
          // links that we want to consider external
          if (link.dataset.originalHref !== undefined) {
            link.href = link.dataset.originalHref;
          }
        }
      }
    function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
      const config = {
        allowHTML: true,
        maxWidth: 500,
        delay: 100,
        arrow: false,
        appendTo: function(el) {
            return el.parentElement;
        },
        interactive: true,
        interactiveBorder: 10,
        theme: 'quarto',
        placement: 'bottom-start',
      };
      if (contentFn) {
        config.content = contentFn;
      }
      if (onTriggerFn) {
        config.onTrigger = onTriggerFn;
      }
      if (onUntriggerFn) {
        config.onUntrigger = onUntriggerFn;
      }
      window.tippy(el, config); 
    }
    const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
    for (var i=0; i<noterefs.length; i++) {
      const ref = noterefs[i];
      tippyHover(ref, function() {
        // use id or data attribute instead here
        let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
        try { href = new URL(href).hash; } catch {}
        const id = href.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note) {
          return note.innerHTML;
        } else {
          return "";
        }
      });
    }
    const xrefs = window.document.querySelectorAll('a.quarto-xref');
    const processXRef = (id, note) => {
      // Strip column container classes
      const stripColumnClz = (el) => {
        el.classList.remove("page-full", "page-columns");
        if (el.children) {
          for (const child of el.children) {
            stripColumnClz(child);
          }
        }
      }
      stripColumnClz(note)
      if (id === null || id.startsWith('sec-')) {
        // Special case sections, only their first couple elements
        const container = document.createElement("div");
        if (note.children && note.children.length > 2) {
          container.appendChild(note.children[0].cloneNode(true));
          for (let i = 1; i < note.children.length; i++) {
            const child = note.children[i];
            if (child.tagName === "P" && child.innerText === "") {
              continue;
            } else {
              container.appendChild(child.cloneNode(true));
              break;
            }
          }
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(container);
          }
          return container.innerHTML
        } else {
          if (window.Quarto?.typesetMath) {
            window.Quarto.typesetMath(note);
          }
          return note.innerHTML;
        }
      } else {
        // Remove any anchor links if they are present
        const anchorLink = note.querySelector('a.anchorjs-link');
        if (anchorLink) {
          anchorLink.remove();
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        if (note.classList.contains("callout")) {
          return note.outerHTML;
        } else {
          return note.innerHTML;
        }
      }
    }
    for (var i=0; i<xrefs.length; i++) {
      const xref = xrefs[i];
      tippyHover(xref, undefined, function(instance) {
        instance.disable();
        let url = xref.getAttribute('href');
        let hash = undefined; 
        if (url.startsWith('#')) {
          hash = url;
        } else {
          try { hash = new URL(url).hash; } catch {}
        }
        if (hash) {
          const id = hash.replace(/^#\/?/, "");
          const note = window.document.getElementById(id);
          if (note !== null) {
            try {
              const html = processXRef(id, note.cloneNode(true));
              instance.setContent(html);
            } finally {
              instance.enable();
              instance.show();
            }
          } else {
            // See if we can fetch this
            fetch(url.split('#')[0])
            .then(res => res.text())
            .then(html => {
              const parser = new DOMParser();
              const htmlDoc = parser.parseFromString(html, "text/html");
              const note = htmlDoc.getElementById(id);
              if (note !== null) {
                const html = processXRef(id, note);
                instance.setContent(html);
              } 
            }).finally(() => {
              instance.enable();
              instance.show();
            });
          }
        } else {
          // See if we can fetch a full url (with no hash to target)
          // This is a special case and we should probably do some content thinning / targeting
          fetch(url)
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.querySelector('main.content');
            if (note !== null) {
              // This should only happen for chapter cross references
              // (since there is no id in the URL)
              // remove the first header
              if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
                note.children[0].remove();
              }
              const html = processXRef(null, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      }, function(instance) {
      });
    }
        let selectedAnnoteEl;
        const selectorForAnnotation = ( cell, annotation) => {
          let cellAttr = 'data-code-cell="' + cell + '"';
          let lineAttr = 'data-code-annotation="' +  annotation + '"';
          const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
          return selector;
        }
        const selectCodeLines = (annoteEl) => {
          const doc = window.document;
          const targetCell = annoteEl.getAttribute("data-target-cell");
          const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
          const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
          const lines = annoteSpan.getAttribute("data-code-lines").split(",");
          const lineIds = lines.map((line) => {
            return targetCell + "-" + line;
          })
          let top = null;
          let height = null;
          let parent = null;
          if (lineIds.length > 0) {
              //compute the position of the single el (top and bottom and make a div)
              const el = window.document.getElementById(lineIds[0]);
              top = el.offsetTop;
              height = el.offsetHeight;
              parent = el.parentElement.parentElement;
            if (lineIds.length > 1) {
              const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
              const bottom = lastEl.offsetTop + lastEl.offsetHeight;
              height = bottom - top;
            }
            if (top !== null && height !== null && parent !== null) {
              // cook up a div (if necessary) and position it 
              let div = window.document.getElementById("code-annotation-line-highlight");
              if (div === null) {
                div = window.document.createElement("div");
                div.setAttribute("id", "code-annotation-line-highlight");
                div.style.position = 'absolute';
                parent.appendChild(div);
              }
              div.style.top = top - 2 + "px";
              div.style.height = height + 4 + "px";
              div.style.left = 0;
              let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
              if (gutterDiv === null) {
                gutterDiv = window.document.createElement("div");
                gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
                gutterDiv.style.position = 'absolute';
                const codeCell = window.document.getElementById(targetCell);
                const gutter = codeCell.querySelector('.code-annotation-gutter');
                gutter.appendChild(gutterDiv);
              }
              gutterDiv.style.top = top - 2 + "px";
              gutterDiv.style.height = height + 4 + "px";
            }
            selectedAnnoteEl = annoteEl;
          }
        };
        const unselectCodeLines = () => {
          const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
          elementsIds.forEach((elId) => {
            const div = window.document.getElementById(elId);
            if (div) {
              div.remove();
            }
          });
          selectedAnnoteEl = undefined;
        };
          // Handle positioning of the toggle
      window.addEventListener(
        "resize",
        throttle(() => {
          elRect = undefined;
          if (selectedAnnoteEl) {
            selectCodeLines(selectedAnnoteEl);
          }
        }, 10)
      );
      function throttle(fn, ms) {
      let throttle = false;
      let timer;
        return (...args) => {
          if(!throttle) { // first call gets through
              fn.apply(this, args);
              throttle = true;
          } else { // all the others get throttled
              if(timer) clearTimeout(timer); // cancel #2
              timer = setTimeout(() => {
                fn.apply(this, args);
                timer = throttle = false;
              }, ms);
          }
        };
      }
        // Attach click handler to the DT
        const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
        for (const annoteDlNode of annoteDls) {
          annoteDlNode.addEventListener('click', (event) => {
            const clickedEl = event.target;
            if (clickedEl !== selectedAnnoteEl) {
              unselectCodeLines();
              const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
              if (activeEl) {
                activeEl.classList.remove('code-annotation-active');
              }
              selectCodeLines(clickedEl);
              clickedEl.classList.add('code-annotation-active');
            } else {
              // Unselect the line
              unselectCodeLines();
              clickedEl.classList.remove('code-annotation-active');
            }
          });
        }
    const findCites = (el) => {
      const parentEl = el.parentElement;
      if (parentEl) {
        const cites = parentEl.dataset.cites;
        if (cites) {
          return {
            el,
            cites: cites.split(' ')
          };
        } else {
          return findCites(el.parentElement)
        }
      } else {
        return undefined;
      }
    };
    var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
    for (var i=0; i<bibliorefs.length; i++) {
      const ref = bibliorefs[i];
      const citeInfo = findCites(ref);
      if (citeInfo) {
        tippyHover(citeInfo.el, function() {
          var popup = window.document.createElement('div');
          citeInfo.cites.forEach(function(cite) {
            var citeDiv = window.document.createElement('div');
            citeDiv.classList.add('hanging-indent');
            citeDiv.classList.add('csl-entry');
            var biblioDiv = window.document.getElementById('ref-' + cite);
            if (biblioDiv) {
              citeDiv.innerHTML = biblioDiv.innerHTML;
            }
            popup.appendChild(citeDiv);
          });
          return popup.innerHTML;
        });
      }
    }
  });
  </script>
</div> <!-- /content -->




</body></html>